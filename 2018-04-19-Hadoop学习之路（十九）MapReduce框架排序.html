<!DOCTYPE HTML>
<html lang="zh-CN">

<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="福星">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://zhangfuxin.cn">
    <!--SEO-->

<meta name="keywords" content="Hadoop">


<meta name="description" content="** Hadoop学习之路（十九）MapReduce框架排序：** &lt;Excerpt in index | 首页摘要&gt;
​        Hadoop学习之路（十九）MapReduc...">


<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->

<title>
    
    Hadoop学习之路（十九）MapReduce框架排序 |
    
    福星
</title>

<link rel="alternate" href="/atom.xml" title="福星" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<script>
(function() {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</head></html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    http://snippet.shenliyang.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='福 星'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://zhangfuxin.cn">
                        福星</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Linux/"><i class="fa "></i>
                                Linux</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Hadoop/"><i class="fa "></i>
                                Hadoop</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Spark/"><i class="fa "></i>
                                Spark</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Java/"><i class="fa "></i>
                                Java</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Python/"><i class="fa "></i>
                                Python</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/algorithm/"><i class="fa "></i>
                                算法</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/工具/"><i class="fa "></i>
                                工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Hadoop学习之路（十九）MapReduce框架排序">
            
            Hadoop学习之路（十九）MapReduce框架排序
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/Hadoop/">Hadoop</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-link" href="/tags/Hadoop/">Hadoop</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2018/04/19</span>
    </span>
    
    <span class="fa-wrap">
        <i class="fa fa-eye"></i>
        <span id="busuanzi_value_page_pv"></span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>** Hadoop学习之路（十九）MapReduce框架排序：** &lt;Excerpt in index | 首页摘要&gt;</p>
<p>​        Hadoop学习之路（十九）MapReduce框架排序</p>
<a id="more"></a>
<p>&lt;The rest of contents | 余下全文&gt;</p>
<h2 id="流量统计项目案例"><a href="#流量统计项目案例" class="headerlink" title="流量统计项目案例"></a>流量统计项目案例</h2><p>样本示例</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201803/1228818-20180316200328379-1669863657.png" alt="img"></p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201803/1228818-20180316200409522-1315468418.png" alt="img"></p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p>1、 统计每一个用户（手机号）所耗费的总上行流量、总下行流量，总流量</p>
<p>2、 得出上题结果的基础之上再加一个需求：将统计结果按照总流量倒序排序</p>
<p>3、 将流量汇总统计结果按照手机归属地不同省份输出到不同文件中</p>
<p>第一题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">import org.apache.hadoop.conf.Configuration;</span><br><span class="line">import org.apache.hadoop.fs.Path;</span><br><span class="line">import org.apache.hadoop.io.LongWritable;</span><br><span class="line">import org.apache.hadoop.io.Text;</span><br><span class="line">import org.apache.hadoop.mapreduce.Job;</span><br><span class="line">import org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line">import org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *    第一题：统计每一个用户（手机号）所耗费的总上行流量、总下行流量，总流量</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class FlowSumMR &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        Configuration conf = new Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf, &quot;FlowSumMR&quot;);</span><br><span class="line">        job.setJarByClass(FlowSumMR.class);</span><br><span class="line">        </span><br><span class="line">        job.setMapperClass(FlowSumMRMapper.class);</span><br><span class="line">        job.setReducerClass(FlowSumMRReducer.class);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        FileInputFormat.setInputPaths(job, new Path(&quot;E:/bigdata/flow/input/&quot;));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, new Path(&quot;E:/bigdata/flow/output_sum&quot;));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        boolean isDone = job.waitForCompletion(true);</span><br><span class="line">        System.exit(isDone ? 0 : 1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static class FlowSumMRMapper extends Mapper&lt;LongWritable, Text, Text, Text&gt;&#123;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * value  =  1363157993044     18211575961    94-71-AC-CD-E6-18:CMCC-EASY    120.196.100.99    </span><br><span class="line">         * iface.qiyi.com    视频网站    15    12    1527    2106    200</span><br><span class="line">         */</span><br><span class="line">        @Override</span><br><span class="line">        protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            String[] split = value.toString().split(&quot;\t&quot;);</span><br><span class="line">            </span><br><span class="line">            String outkey = split[1];</span><br><span class="line">            </span><br><span class="line">            String outValue = split[8] + &quot;\t&quot; + split[9];</span><br><span class="line">            </span><br><span class="line">            context.write(new Text(outkey), new Text(outValue));</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static class FlowSumMRReducer extends Reducer&lt;Text, Text, Text, Text&gt;&#123;</span><br><span class="line">        </span><br><span class="line">        @Override</span><br><span class="line">        protected void reduce(Text key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException &#123;</span><br><span class="line">            </span><br><span class="line">            int upFlow = 0;</span><br><span class="line">            int downFlow = 0;</span><br><span class="line">            int sumFlow = 0;</span><br><span class="line">            </span><br><span class="line">            for(Text t : values)&#123;</span><br><span class="line">                String[] split = t.toString().split(&quot;\t&quot;);</span><br><span class="line">                </span><br><span class="line">                int upTempFlow = Integer.parseInt(split[0]);</span><br><span class="line">                int downTempFlow = Integer.parseInt(split[1]);</span><br><span class="line">                </span><br><span class="line">                upFlow+=upTempFlow;</span><br><span class="line">                downFlow +=  downTempFlow;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            sumFlow = upFlow + downFlow;</span><br><span class="line">            </span><br><span class="line">            context.write(key, new Text(upFlow + &quot;\t&quot; + downFlow + &quot;\t&quot; + sumFlow));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">import org.apache.hadoop.conf.Configuration;</span><br><span class="line">import org.apache.hadoop.fs.Path;</span><br><span class="line">import org.apache.hadoop.io.LongWritable;</span><br><span class="line">import org.apache.hadoop.io.NullWritable;</span><br><span class="line">import org.apache.hadoop.io.Text;</span><br><span class="line">import org.apache.hadoop.mapreduce.Job;</span><br><span class="line">import org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line">import org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line">import comg.ghgj.mr.pojo.FlowBean;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 需求： 第二个题目，就是对第一个题目的结果数据，进行按照总流量倒叙排序</span><br><span class="line"> * </span><br><span class="line"> * </span><br><span class="line"> */</span><br><span class="line">public class FlowSortMR &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">        Configuration conf = new Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf, &quot;FlowSumMR&quot;);</span><br><span class="line">        job.setJarByClass(FlowSortMR.class);</span><br><span class="line">        </span><br><span class="line">        job.setMapperClass(FlowSortMRMapper.class);</span><br><span class="line">        job.setReducerClass(FlowSortMRReducer.class);</span><br><span class="line">        </span><br><span class="line">        job.setOutputKeyClass(FlowBean.class);</span><br><span class="line">        job.setOutputValueClass(NullWritable.class);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        FileInputFormat.setInputPaths(job, new Path(&quot;E:/bigdata/flow/output_sum&quot;));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, new Path(&quot;E:/bigdata/flow/output_sort_777&quot;));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        boolean isDone = job.waitForCompletion(true);</span><br><span class="line">        System.exit(isDone ? 0 : 1);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static class FlowSortMRMapper extends Mapper&lt;LongWritable, Text, FlowBean, NullWritable&gt;&#123;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * value  = 13602846565    26860680    40332600    67193280</span><br><span class="line">         */</span><br><span class="line">        @Override</span><br><span class="line">        protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123;</span><br><span class="line">            </span><br><span class="line">            String[] split = value.toString().split(&quot;\t&quot;);</span><br><span class="line">            </span><br><span class="line">            FlowBean fb = new FlowBean(split[0], Long.parseLong(split[1]), Long.parseLong(split[2]));</span><br><span class="line">            </span><br><span class="line">            context.write(fb, NullWritable.get());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static class FlowSortMRReducer extends Reducer&lt;FlowBean, NullWritable, FlowBean, NullWritable&gt;&#123;</span><br><span class="line">        </span><br><span class="line">        @Override</span><br><span class="line">        protected void reduce(FlowBean key, Iterable&lt;NullWritable&gt; values, Context context)</span><br><span class="line">                throws IOException, InterruptedException &#123;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            for(NullWritable nvl : values)&#123;</span><br><span class="line">                context.write(key, nvl);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>FlowBean.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">  1 import java.io.DataInput;</span><br><span class="line">  2 import java.io.DataOutput;</span><br><span class="line">  3 import java.io.IOException;</span><br><span class="line">  4 </span><br><span class="line">  5 import org.apache.hadoop.io.WritableComparable;</span><br><span class="line">  6 </span><br><span class="line">  7 /**</span><br><span class="line">  8  * 第一，定义好属性</span><br><span class="line">  9  * 第二，定义好属性的getter 和 setter方法</span><br><span class="line"> 10  * 第三，定义好构造方法（有参，无参）</span><br><span class="line"> 11  * 第四：定义好toString();</span><br><span class="line"> 12  * </span><br><span class="line"> 13  * </span><br><span class="line"> 14  * 详细解释：</span><br><span class="line"> 15  * </span><br><span class="line"> 16  * 如果一个自定义对象要作为key 必须要实现 WritableComparable 接口， 而不能实现 Writable, Comparable</span><br><span class="line"> 17  * </span><br><span class="line"> 18  * 如果一个自定义对象要作为value，那么只需要实现Writable接口即可</span><br><span class="line"> 19  */</span><br><span class="line"> 20 public class FlowBean implements WritableComparable&lt;FlowBean&gt;&#123;</span><br><span class="line"> 21 //public class FlowBean implements Comparable&lt;FlowBean&gt;&#123;</span><br><span class="line"> 22 </span><br><span class="line"> 23     private String phone;</span><br><span class="line"> 24     private long upFlow;</span><br><span class="line"> 25     private long downFlow;</span><br><span class="line"> 26     private long sumFlow;</span><br><span class="line"> 27     public String getPhone() &#123;</span><br><span class="line"> 28         return phone;</span><br><span class="line"> 29     &#125;</span><br><span class="line"> 30     public void setPhone(String phone) &#123;</span><br><span class="line"> 31         this.phone = phone;</span><br><span class="line"> 32     &#125;</span><br><span class="line"> 33     public long getUpFlow() &#123;</span><br><span class="line"> 34         return upFlow;</span><br><span class="line"> 35     &#125;</span><br><span class="line"> 36     public void setUpFlow(long upFlow) &#123;</span><br><span class="line"> 37         this.upFlow = upFlow;</span><br><span class="line"> 38     &#125;</span><br><span class="line"> 39     public long getDownFlow() &#123;</span><br><span class="line"> 40         return downFlow;</span><br><span class="line"> 41     &#125;</span><br><span class="line"> 42     public void setDownFlow(long downFlow) &#123;</span><br><span class="line"> 43         this.downFlow = downFlow;</span><br><span class="line"> 44     &#125;</span><br><span class="line"> 45     public long getSumFlow() &#123;</span><br><span class="line"> 46         return sumFlow;</span><br><span class="line"> 47     &#125;</span><br><span class="line"> 48     public void setSumFlow(long sumFlow) &#123;</span><br><span class="line"> 49         this.sumFlow = sumFlow;</span><br><span class="line"> 50     &#125;</span><br><span class="line"> 51     public FlowBean(String phone, long upFlow, long downFlow, long sumFlow) &#123;</span><br><span class="line"> 52         super();</span><br><span class="line"> 53         this.phone = phone;</span><br><span class="line"> 54         this.upFlow = upFlow;</span><br><span class="line"> 55         this.downFlow = downFlow;</span><br><span class="line"> 56         this.sumFlow = sumFlow;</span><br><span class="line"> 57     &#125;</span><br><span class="line"> 58     public FlowBean(String phone, long upFlow, long downFlow) &#123;</span><br><span class="line"> 59         super();</span><br><span class="line"> 60         this.phone = phone;</span><br><span class="line"> 61         this.upFlow = upFlow;</span><br><span class="line"> 62         this.downFlow = downFlow;</span><br><span class="line"> 63         this.sumFlow = upFlow + downFlow;</span><br><span class="line"> 64     &#125;</span><br><span class="line"> 65     public FlowBean() &#123;</span><br><span class="line"> 66         super();</span><br><span class="line"> 67         // TODO Auto-generated constructor stub</span><br><span class="line"> 68     &#125;</span><br><span class="line"> 69     @Override</span><br><span class="line"> 70     public String toString() &#123;</span><br><span class="line"> 71         return  phone + &quot;\t&quot; + upFlow + &quot;\t&quot; + downFlow + &quot;\t&quot; + sumFlow;</span><br><span class="line"> 72     &#125;</span><br><span class="line"> 73     </span><br><span class="line"> 74     </span><br><span class="line"> 75     </span><br><span class="line"> 76     </span><br><span class="line"> 77     /**</span><br><span class="line"> 78      * 把当前这个对象 --- 谁掉用这个write方法，谁就是当前对象</span><br><span class="line"> 79      * </span><br><span class="line"> 80      * FlowBean bean = new FlowBean();</span><br><span class="line"> 81      * </span><br><span class="line"> 82      * bean.write(out)    把bean这个对象的四个属性序列化出去</span><br><span class="line"> 83      * </span><br><span class="line"> 84      *  this = bean</span><br><span class="line"> 85      */</span><br><span class="line"> 86     @Override</span><br><span class="line"> 87     public void write(DataOutput out) throws IOException &#123;</span><br><span class="line"> 88         // TODO Auto-generated method stub</span><br><span class="line"> 89         </span><br><span class="line"> 90         out.writeUTF(phone);</span><br><span class="line"> 91         out.writeLong(upFlow);</span><br><span class="line"> 92         out.writeLong(downFlow);</span><br><span class="line"> 93         out.writeLong(sumFlow);</span><br><span class="line"> 94         </span><br><span class="line"> 95     &#125;</span><br><span class="line"> 96     </span><br><span class="line"> 97     </span><br><span class="line"> 98     //   序列化方法中的写出的字段顺序， 一定一定一定要和 反序列化中的 接收顺序一致。 类型也一定要一致</span><br><span class="line"> 99     </span><br><span class="line">100     </span><br><span class="line">101     /**</span><br><span class="line">102      * bean.readField();</span><br><span class="line">103      * </span><br><span class="line">104      *             upFlow = </span><br><span class="line">105      */</span><br><span class="line">106     @Override</span><br><span class="line">107     public void readFields(DataInput in) throws IOException &#123;</span><br><span class="line">108         // TODO Auto-generated method stub</span><br><span class="line">109         </span><br><span class="line">110         phone = in.readUTF();</span><br><span class="line">111         upFlow = in.readLong();</span><br><span class="line">112         downFlow = in.readLong();</span><br><span class="line">113         sumFlow = in.readLong();</span><br><span class="line">114         </span><br><span class="line">115     &#125;</span><br><span class="line">116     </span><br><span class="line">117     </span><br><span class="line">118     </span><br><span class="line">119     /**</span><br><span class="line">120      * Hadoop的序列化机制为什么不用   java自带的实现 Serializable这种方式？</span><br><span class="line">121      * </span><br><span class="line">122      * 本身Hadoop就是用来解决大数据问题的。</span><br><span class="line">123      * </span><br><span class="line">124      * 那么实现Serializable接口这种方式，在进行序列化的时候。除了会序列化属性值之外，还会携带很多跟当前这个对象的类相关的各种信息</span><br><span class="line">125      * </span><br><span class="line">126      * Hadoop采取了一种全新的序列化机制；只需要序列化 每个对象的属性值即可。</span><br><span class="line">127      */</span><br><span class="line">128     </span><br><span class="line">129     </span><br><span class="line">130     </span><br><span class="line">131     /*@Override</span><br><span class="line">132       public void readFields(DataInput in) throws IOException &#123;</span><br><span class="line">133         value = in.readLong();</span><br><span class="line">134       &#125;</span><br><span class="line">135 </span><br><span class="line">136       @Override</span><br><span class="line">137       public void write(DataOutput out) throws IOException &#123;</span><br><span class="line">138         out.writeLong(value);</span><br><span class="line">139       &#125;*/</span><br><span class="line">140     </span><br><span class="line">141     </span><br><span class="line">142     /**</span><br><span class="line">143      * 用来指定排序规则</span><br><span class="line">144      */</span><br><span class="line">145     @Override</span><br><span class="line">146     public int compareTo(FlowBean fb) &#123;</span><br><span class="line">147 </span><br><span class="line">148         long diff = this.getSumFlow() - fb.getSumFlow();</span><br><span class="line">149         </span><br><span class="line">150         if(diff == 0)&#123;</span><br><span class="line">151             return 0;</span><br><span class="line">152         &#125;else&#123;</span><br><span class="line">153             return diff &gt; 0 ? -1 : 1;</span><br><span class="line">154         &#125;</span><br><span class="line">155         </span><br><span class="line">156     &#125;</span><br><span class="line">157 &#125;</span><br></pre></td></tr></table></figure>

<p>第三题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">package comg.ghgj.mr.flow;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">import org.apache.hadoop.conf.Configuration;</span><br><span class="line">import org.apache.hadoop.fs.FileSystem;</span><br><span class="line">import org.apache.hadoop.fs.Path;</span><br><span class="line">import org.apache.hadoop.io.LongWritable;</span><br><span class="line">import org.apache.hadoop.io.Text;</span><br><span class="line">import org.apache.hadoop.mapreduce.Job;</span><br><span class="line">import org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line">import org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line">import org.apache.hadoop.mapreduce.lib.partition.ProvincePartitioner;</span><br><span class="line"></span><br><span class="line">public class FlowPartitionerMR &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        Configuration conf = new Configuration();</span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line">        Job job = Job.getInstance(conf, &quot;FlowSumMR&quot;);</span><br><span class="line">        job.setJarByClass(FlowPartitionerMR.class);</span><br><span class="line">        </span><br><span class="line">        job.setMapperClass(FlowPartitionerMRMapper.class);</span><br><span class="line">        job.setReducerClass(FlowPartitionerMRReducer.class);</span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * 非常重要的两句代码</span><br><span class="line">         */</span><br><span class="line">        job.setPartitionerClass(ProvincePartitioner.class);</span><br><span class="line">        job.setNumReduceTasks(10);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        FileInputFormat.setInputPaths(job, new Path(&quot;E:\\bigdata\\flow\\input&quot;));</span><br><span class="line">        Path outputPath = new Path(&quot;E:\\bigdata\\flow\\output_ptn2&quot;);</span><br><span class="line">        if(fs.exists(outputPath))&#123;</span><br><span class="line">            fs.delete(outputPath, true);</span><br><span class="line">        &#125;</span><br><span class="line">        FileOutputFormat.setOutputPath(job, outputPath);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        boolean isDone = job.waitForCompletion(true);</span><br><span class="line">        System.exit(isDone ? 0 : 1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static class FlowPartitionerMRMapper extends Mapper&lt;LongWritable, Text, Text, Text&gt;&#123;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * value  =  13502468823    101663100    1529437140    1631100240</span><br><span class="line">         */</span><br><span class="line">        @Override</span><br><span class="line">        protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException &#123;</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            String[] split = value.toString().split(&quot;\t&quot;);</span><br><span class="line">            </span><br><span class="line">            String outkey = split[1];</span><br><span class="line">            String outValue = split[8] + &quot;\t&quot; + split[9];</span><br><span class="line">            </span><br><span class="line">            context.write(new Text(outkey), new Text(outValue));</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static class FlowPartitionerMRReducer extends Reducer&lt;Text, Text, Text, Text&gt;&#123;</span><br><span class="line">        </span><br><span class="line">        @Override</span><br><span class="line">        protected void reduce(Text key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException &#123;</span><br><span class="line">            </span><br><span class="line">            int upFlow = 0;</span><br><span class="line">            int downFlow = 0;</span><br><span class="line">            int sumFlow = 0;</span><br><span class="line">            </span><br><span class="line">            for(Text t : values)&#123;</span><br><span class="line">                String[] split = t.toString().split(&quot;\t&quot;);</span><br><span class="line">                </span><br><span class="line">                int upTempFlow = Integer.parseInt(split[0]);</span><br><span class="line">                int downTempFlow = Integer.parseInt(split[1]);</span><br><span class="line">                </span><br><span class="line">                upFlow+=upTempFlow;</span><br><span class="line">                downFlow +=  downTempFlow;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            sumFlow = upFlow + downFlow;</span><br><span class="line">            </span><br><span class="line">            context.write(key, new Text(upFlow + &quot;\t&quot; + downFlow + &quot;\t&quot; + sumFlow));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="https://github.com/wenxinzhang" target="_blank">福星</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2018-04-20-Hadoop学习之路（二十）MapReduce求TopN.html" class="pre-post btn btn-default" title='Hadoop学习之路（二十）MapReduce求TopN'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            Hadoop学习之路（二十）MapReduce求TopN</span>
    </a>
    
    
    <a href="/2018-04-18-Hadoop学习之路（十八）MapReduce框架Combiner分区.html" class="next-post btn btn-default" title='Hadoop学习之路（十八）MapReduce框架Combiner分区'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            Hadoop学习之路（十八）MapReduce框架Combiner分区</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>
<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'UckE9LEIQ8aoa3MH1Kio27rB-gzGzoHsz',
    appKey: '7HC9xCVYQdshKqFRDmULFm5G',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'zh-CN'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#流量统计项目案例"><span class="toc-text">流量统计项目案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#需求"><span class="toc-text">需求</span></a></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
    访问量:
    <strong id="busuanzi_value_site_pv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    &nbsp; | &nbsp;
    访客数:
    <strong id="busuanzi_value_site_uv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2018
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/js/app.js?rev=@@hash"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":200,"height":350},"mobile":{"show":true}});</script></body>
</html>