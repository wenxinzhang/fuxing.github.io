<!DOCTYPE HTML>
<html lang="zh-CN">

<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="福星">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://zhangfuxin.cn">
    <!--SEO-->

<meta name="keywords" content="Flume">


<meta name="description" content="** Kafka学习之路 （五）Kafka在zookeeper中的存储：** &lt;Excerpt in index | 首页摘要&gt;
​        Kafka学习之路 （五）Kafk...">


<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->

<title>
    
    Kafka学习之路 （五）Kafka在zookeeper中的存储 |
    
    福星
</title>

<link rel="alternate" href="/atom.xml" title="福星" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<script>
(function() {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</head></html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    http://snippet.shenliyang.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='福 星'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://zhangfuxin.cn">
                        福星</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Linux/"><i class="fa "></i>
                                Linux</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Hadoop/"><i class="fa "></i>
                                Hadoop</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Spark/"><i class="fa "></i>
                                Spark</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Java/"><i class="fa "></i>
                                Java</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Python/"><i class="fa "></i>
                                Python</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/algorithm/"><i class="fa "></i>
                                算法</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/工具/"><i class="fa "></i>
                                工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Kafka学习之路 （五）Kafka在zookeeper中的存储">
            
            Kafka学习之路 （五）Kafka在zookeeper中的存储
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/Hadoop/">Hadoop</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-link" href="/tags/Flume/">Flume</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2018/05/08</span>
    </span>
    
    <span class="fa-wrap">
        <i class="fa fa-eye"></i>
        <span id="busuanzi_value_page_pv"></span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>** Kafka学习之路 （五）Kafka在zookeeper中的存储：** &lt;Excerpt in index | 首页摘要&gt;</p>
<p>​        Kafka学习之路 （五）Kafka在zookeeper中的存储</p>
<a id="more"></a>
<p>&lt;The rest of contents | 余下全文&gt;</p>
<h2 id="一、Kafka在zookeeper中存储结构图"><a href="#一、Kafka在zookeeper中存储结构图" class="headerlink" title="一、Kafka在zookeeper中存储结构图"></a>一、Kafka在zookeeper中存储结构图</h2><p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508101652574-1613892176.png" alt="img"></p>
<h2 id="二、分析"><a href="#二、分析" class="headerlink" title="二、分析"></a>二、分析</h2><h3 id="2-1-topic注册信息"><a href="#2-1-topic注册信息" class="headerlink" title="2.1　topic注册信息"></a>2.1　topic注册信息</h3><p>/brokers/topics/[topic] :</p>
<p>存储某个topic的partitions所有分配信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 1] get /brokers/topics/topic2</span><br></pre></td></tr></table></figure>

<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508103023550-1689525175.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Schema:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;版本编号目前固定为数字1&quot;,</span><br><span class="line">    &quot;partitions&quot;: &#123;</span><br><span class="line">        &quot;partitionId编号&quot;: [</span><br><span class="line">            同步副本组brokerId列表</span><br><span class="line">        ],</span><br><span class="line">        &quot;partitionId编号&quot;: [</span><br><span class="line">            同步副本组brokerId列表</span><br><span class="line">        ],</span><br><span class="line">        .......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Example:</span><br><span class="line">&#123;</span><br><span class="line">&quot;version&quot;: 1,</span><br><span class="line">&quot;partitions&quot;: &#123;</span><br><span class="line">&quot;2&quot;: [1, 2, 3],</span><br><span class="line">&quot;1&quot;: [0, 1, 2],</span><br><span class="line">&quot;0&quot;: [3, 0, 1],</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-partition状态信息"><a href="#2-2-partition状态信息" class="headerlink" title="2.2　partition状态信息"></a>2.2　partition状态信息</h3><p>/brokers/topics/[topic]/partitions/[0…N]  其中[0..N]表示partition索引号</p>
<p>/brokers/topics/[topic]/partitions/[partitionId]/state</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508103535274-360887579.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Schema:</span><br><span class="line">&#123;</span><br><span class="line">&quot;controller_epoch&quot;: 表示kafka集群中的中央控制器选举次数,</span><br><span class="line">&quot;leader&quot;: 表示该partition选举leader的brokerId,</span><br><span class="line">&quot;version&quot;: 版本编号默认为1,</span><br><span class="line">&quot;leader_epoch&quot;: 该partition leader选举次数,</span><br><span class="line">&quot;isr&quot;: [同步副本组brokerId列表]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Example:</span><br><span class="line">&#123;</span><br><span class="line">&quot;controller_epoch&quot;: 1,</span><br><span class="line">&quot;leader&quot;: 3,</span><br><span class="line">&quot;version&quot;: 1,</span><br><span class="line">&quot;leader_epoch&quot;: 0,</span><br><span class="line">&quot;isr&quot;: [3, 0, 1]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-Broker注册信息"><a href="#2-3-Broker注册信息" class="headerlink" title="2.3　Broker注册信息"></a>2.3　Broker注册信息</h3><p>/brokers/ids/[0…N]                 </p>
<p>每个broker的配置文件中都需要指定一个数字类型的id(全局不可重复),此节点为临时znode(EPHEMERAL)</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508103818455-1476762306.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Schema:</span><br><span class="line">&#123;</span><br><span class="line">&quot;jmx_port&quot;: jmx端口号,</span><br><span class="line">&quot;timestamp&quot;: kafka broker初始启动时的时间戳,</span><br><span class="line">&quot;host&quot;: 主机名或ip地址,</span><br><span class="line">&quot;version&quot;: 版本编号默认为1,</span><br><span class="line">&quot;port&quot;: kafka broker的服务端端口号,由server.properties中参数port确定</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Example:</span><br><span class="line">&#123;</span><br><span class="line">&quot;jmx_port&quot;: -1,</span><br><span class="line">&quot;timestamp&quot;:&quot;1525741823119&quot;</span><br><span class="line">&quot;version&quot;: 1,</span><br><span class="line">&quot;host&quot;: &quot;hadoop1&quot;,</span><br><span class="line">&quot;port&quot;: 9092</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Controller-epoch"><a href="#2-4-Controller-epoch" class="headerlink" title="2.4　Controller epoch"></a>2.4　Controller epoch</h3><p>/controller_epoch –&gt;  int (epoch)   </p>
<p>此值为一个数字,kafka集群中第一个broker第一次启动时为1，以后只要集群中center controller中央控制器所在broker变更或挂掉，就会重新选举新的center controller，每次center controller变更controller_epoch值就会 + 1; </p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508104057913-1808088971.png" alt="img"></p>
<h3 id="2-5-Controller注册信息"><a href="#2-5-Controller注册信息" class="headerlink" title="2.5　Controller注册信息"></a>2.5　Controller注册信息</h3><p>/controller -&gt; int (broker id of the controller)  存储center controller中央控制器所在kafka broker的信息</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508104206487-400676103.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Schema:</span><br><span class="line">&#123;</span><br><span class="line">&quot;version&quot;: 版本编号默认为1,</span><br><span class="line">&quot;brokerid&quot;: kafka集群中broker唯一编号,</span><br><span class="line">&quot;timestamp&quot;: kafka broker中央控制器变更时的时间戳</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Example:</span><br><span class="line">&#123;</span><br><span class="line">&quot;version&quot;: 1,</span><br><span class="line">&quot;brokerid&quot;: 0,</span><br><span class="line">&quot;timestamp&quot;: &quot;1525741822769&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-补充Consumer-and-Consumer-group"><a href="#2-6-补充Consumer-and-Consumer-group" class="headerlink" title="2.6　补充Consumer and Consumer group"></a>2.6　补充Consumer and Consumer group</h3><p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508104651193-86573907.png" alt="img"></p>
<p><strong>a.每个consumer客户端被创建时,会向zookeeper注册自己的信息;</strong><br><strong>b.此作用主要是为了”负载均衡”.</strong><br><strong>c.同一个Consumer Group中的Consumers，Kafka将相应Topic中的每个消息只发送给其中一个Consumer。</strong><br><strong>d.Consumer Group中的每个Consumer读取Topic的一个或多个Partitions，并且是唯一的Consumer；</strong><br><strong>e.一个Consumer group的多个consumer的所有线程依次有序地消费一个topic的所有partitions,如果Consumer group中所有consumer总线程大于partitions数量，则会出现空闲情况;</strong></p>
<blockquote>
<p><strong>举例说明：</strong></p>
</blockquote>
<blockquote>
<p><strong>kafka集群中创建一个topic为report-log   4 partitions 索引编号为0,1,2,3</strong></p>
</blockquote>
<blockquote>
<p><strong>假如有目前有三个消费者node：注意–&gt;一个consumer中一个消费线程可以消费一个或多个partition.</strong></p>
</blockquote>
<blockquote>
<p><strong>如果每个consumer创建一个consumer thread线程,各个node消费情况如下，node1消费索引编号为0,1分区，node2费索引编号为2,node3费索引编号为3</strong></p>
</blockquote>
<blockquote>
<p><strong>如果每个consumer创建2个consumer thread线程，各个node消费情况如下(是从consumer node先后启动状态来确定的)，node1消费索引编号为0,1分区；node2费索引编号为2,3；node3为空闲状态</strong></p>
</blockquote>
<p><strong>总结：</strong><br><strong>从以上可知，Consumer Group中各个consumer是根据先后启动的顺序有序消费一个topic的所有partitions的。</strong></p>
<p><strong>如果Consumer Group中所有consumer的总线程数大于partitions数量，则可能consumer thread或consumer会出现空闲状态</strong>。</p>
<h3 id="2-7-Consumer均衡算法"><a href="#2-7-Consumer均衡算法" class="headerlink" title="2.7　Consumer均衡算法"></a>2.7　Consumer均衡算法</h3><p><strong>当一个group中,有consumer加入或者离开时,会触发partitions均衡.均衡的最终目的,是提升topic的并发消费能力.</strong><br><strong>1) 假如topic1,具有如下partitions: P0,P1,P2,P3</strong><br><strong>2) 加入group中,有如下consumer: C0,C1</strong><br><strong>3) 首先根据partition索引号对partitions排序: P0,P1,P2,P3</strong><br><strong>4) 根据(consumer.id + ‘-‘+ thread序号)排序: C0,C1</strong><br><strong>5) 计算倍数: M = [P0,P1,P2,P3].size / [C0,C1].size,本例值M=2(向上取整)</strong><br><strong>6) 然后依次分配partitions: C0 = [P0,P1],C1=[P2,P3],即Ci = [P(i * M),P((i + 1) * M -1)]</strong></p>
<h3 id="2-8-Consumer注册信息"><a href="#2-8-Consumer注册信息" class="headerlink" title="2.8　Consumer注册信息"></a>2.8　Consumer注册信息</h3><p>每个consumer都有一个唯一的ID(consumerId可以通过配置文件指定,也可以由系统生成),此id用来标记消费者信息.</p>
<p>/consumers/[groupId]/ids/[consumerIdString]</p>
<p>是一个临时的znode,此节点的值为请看consumerIdString产生规则,即表示此consumer目前所消费的topic + partitions列表.</p>
<p>consumerId产生规则：</p>
<blockquote>
<p>StringconsumerUuid = null;<br>    if(config.consumerId!=null &amp;&amp; config.consumerId)<br>      consumerUuid = consumerId;<br>    else {<br>      String uuid = UUID.randomUUID()<br>      consumerUuid = “%s-%d-%s”.format(<br>        InetAddress.getLocalHost.getHostName, System.currentTimeMillis,<br>        uuid.getMostSignificantBits().toHexString.substring(0,8));</p>
<p>​     }<br>​     String consumerIdString = config.groupId + “_” + consumerUuid;</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 11] get /consumers/console-consumer-2304/ids/console-consumer-2304_hadoop2-1525747915241-6b48ff32</span><br></pre></td></tr></table></figure>



<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508105321039-416763241.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Schema:</span><br><span class="line">&#123;</span><br><span class="line">&quot;version&quot;: 版本编号默认为1,</span><br><span class="line">&quot;subscription&quot;: &#123; //订阅topic列表</span><br><span class="line">&quot;topic名称&quot;: consumer中topic消费者线程数</span><br><span class="line">&#125;,</span><br><span class="line">&quot;pattern&quot;: &quot;static&quot;,</span><br><span class="line">&quot;timestamp&quot;: &quot;consumer启动时的时间戳&quot;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Example:</span><br><span class="line">&#123;</span><br><span class="line">&quot;version&quot;: 1,</span><br><span class="line">&quot;subscription&quot;: &#123;</span><br><span class="line">&quot;topic2&quot;: 1</span><br><span class="line">&#125;,</span><br><span class="line">&quot;pattern&quot;: &quot;white_list&quot;,</span><br><span class="line">&quot;timestamp&quot;: &quot;1525747915336&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-9-Consumer-owner"><a href="#2-9-Consumer-owner" class="headerlink" title="2.9　Consumer owner"></a>2.9　Consumer owner</h3><p>/consumers/[groupId]/owners/[topic]/[partitionId] -&gt; consumerIdString + threadId索引编号</p>
<p>a) 首先进行”Consumer Id注册”;</p>
<p>b) 然后在”Consumer id 注册”节点下注册一个watch用来监听当前group中其他consumer的”退出”和”加入”;只要此znode path下节点列表变更,都会触发此group下consumer的负载均衡.(比如一个consumer失效,那么其他consumer接管partitions).</p>
<p>c) 在”Broker id 注册”节点下,注册一个watch用来监听broker的存活情况;如果broker列表变更,将会触发所有的groups下的consumer重新balance.</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508105839526-553140898.png" alt="img"></p>
<h3 id="2-10-Consumer-offset"><a href="#2-10-Consumer-offset" class="headerlink" title="2.10　Consumer offset"></a>2.10　Consumer offset</h3><p>/consumers/[groupId]/offsets/[topic]/[partitionId] -&gt; long (offset)</p>
<p>用来跟踪每个consumer目前所消费的partition中最大的offset</p>
<p>此znode为持久节点,可以看出offset跟group_id有关,以表明当消费者组(consumer group)中一个消费者失效,</p>
<p>重新触发balance,其他consumer可以继续消费.</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508110049469-140963000.png" alt="img"></p>
<h3 id="2-11-Re-assign-partitions"><a href="#2-11-Re-assign-partitions" class="headerlink" title="2.11　Re-assign partitions"></a>2.11　Re-assign partitions</h3><p>/admin/reassign_partitions</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;fields&quot;:[</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;name&quot;:&quot;version&quot;,</span><br><span class="line">         &quot;type&quot;:&quot;int&quot;,</span><br><span class="line">         &quot;doc&quot;:&quot;version id&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;name&quot;:&quot;partitions&quot;,</span><br><span class="line">         &quot;type&quot;:&#123;</span><br><span class="line">            &quot;type&quot;:&quot;array&quot;,</span><br><span class="line">            &quot;items&quot;:&#123;</span><br><span class="line">               &quot;fields&quot;:[</span><br><span class="line">                  &#123;</span><br><span class="line">                     &quot;name&quot;:&quot;topic&quot;,</span><br><span class="line">                     &quot;type&quot;:&quot;string&quot;,</span><br><span class="line">                     &quot;doc&quot;:&quot;topic of the partition to be reassigned&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line">                     &quot;name&quot;:&quot;partition&quot;,</span><br><span class="line">                     &quot;type&quot;:&quot;int&quot;,</span><br><span class="line">                     &quot;doc&quot;:&quot;the partition to be reassigned&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line">                     &quot;name&quot;:&quot;replicas&quot;,</span><br><span class="line">                     &quot;type&quot;:&quot;array&quot;,</span><br><span class="line">                     &quot;items&quot;:&quot;int&quot;,</span><br><span class="line">                     &quot;doc&quot;:&quot;a list of replica ids&quot;</span><br><span class="line">                  &#125;</span><br><span class="line">               ],</span><br><span class="line">            &#125;</span><br><span class="line">            &quot;doc&quot;:&quot;an array of partitions to be reassigned to new replicas&quot;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Example:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;version&quot;: 1,</span><br><span class="line">  &quot;partitions&quot;:</span><br><span class="line">     [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;topic&quot;: &quot;Foo&quot;,</span><br><span class="line">            &quot;partition&quot;: 1,</span><br><span class="line">            &quot;replicas&quot;: [0, 1, 3]</span><br><span class="line">        &#125;</span><br><span class="line">     ]            </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-12-Preferred-replication-election"><a href="#2-12-Preferred-replication-election" class="headerlink" title="2.12　Preferred replication election"></a>2.12　Preferred replication election</h3><p>/admin/preferred_replica_election</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;fields&quot;:[</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;name&quot;:&quot;version&quot;,</span><br><span class="line">         &quot;type&quot;:&quot;int&quot;,</span><br><span class="line">         &quot;doc&quot;:&quot;version id&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;name&quot;:&quot;partitions&quot;,</span><br><span class="line">         &quot;type&quot;:&#123;</span><br><span class="line">            &quot;type&quot;:&quot;array&quot;,</span><br><span class="line">            &quot;items&quot;:&#123;</span><br><span class="line">               &quot;fields&quot;:[</span><br><span class="line">                  &#123;</span><br><span class="line">                     &quot;name&quot;:&quot;topic&quot;,</span><br><span class="line">                     &quot;type&quot;:&quot;string&quot;,</span><br><span class="line">                     &quot;doc&quot;:&quot;topic of the partition for which preferred replica election should be triggered&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line">                     &quot;name&quot;:&quot;partition&quot;,</span><br><span class="line">                     &quot;type&quot;:&quot;int&quot;,</span><br><span class="line">                     &quot;doc&quot;:&quot;the partition for which preferred replica election should be triggered&quot;</span><br><span class="line">                  &#125;</span><br><span class="line">               ],</span><br><span class="line">            &#125;</span><br><span class="line">            &quot;doc&quot;:&quot;an array of partitions for which preferred replica election should be triggered&quot;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">例子:</span><br><span class="line"> </span><br><span class="line">&#123;</span><br><span class="line">  &quot;version&quot;: 1,</span><br><span class="line">  &quot;partitions&quot;:</span><br><span class="line">     [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;topic&quot;: &quot;Foo&quot;,</span><br><span class="line">            &quot;partition&quot;: 1         </span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;topic&quot;: &quot;Bar&quot;,</span><br><span class="line">            &quot;partition&quot;: 0         </span><br><span class="line">        &#125;</span><br><span class="line">     ]            </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-13-删除topics"><a href="#2-13-删除topics" class="headerlink" title="2.13　删除topics"></a>2.13　删除topics</h3><p>/admin/delete_topics</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508110442336-511702454.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Schema:</span><br><span class="line">&#123; &quot;fields&quot;:</span><br><span class="line">    [ &#123;&quot;name&quot;: &quot;version&quot;, &quot;type&quot;: &quot;int&quot;, &quot;doc&quot;: &quot;version id&quot;&#125;,</span><br><span class="line">      &#123;&quot;name&quot;: &quot;topics&quot;,</span><br><span class="line">       &quot;type&quot;: &#123; &quot;type&quot;: &quot;array&quot;, &quot;items&quot;: &quot;string&quot;, &quot;doc&quot;: &quot;an array of topics to be deleted&quot;&#125;</span><br><span class="line">      &#125; ]</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">例子:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;version&quot;: 1,</span><br><span class="line">  &quot;topics&quot;: [&quot;foo&quot;, &quot;bar&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-14-Topic配置"><a href="#2-14-Topic配置" class="headerlink" title="2.14　Topic配置"></a>2.14　Topic配置</h3><p>/config/topics/[topic_name]</p>
<p><img src="https://images2018.cnblogs.com/blog/1228818/201805/1228818-20180508110605357-406763586.png" alt="img"></p>

    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="https://github.com/wenxinzhang" target="_blank">福星</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2018-06-01-HBase学习之路 （一）HBase基础介绍.html" class="pre-post btn btn-default" title='HBase学习之路 （一）HBase基础介绍'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            HBase学习之路 （一）HBase基础介绍</span>
    </a>
    
    
    <a href="/2018-05-07-Kafka学习之路 （四）Kafka的安装.html" class="next-post btn btn-default" title='Kafka学习之路 （四）Kafka的安装'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            Kafka学习之路 （四）Kafka的安装</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>
<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'UckE9LEIQ8aoa3MH1Kio27rB-gzGzoHsz',
    appKey: '7HC9xCVYQdshKqFRDmULFm5G',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'zh-CN'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、Kafka在zookeeper中存储结构图"><span class="toc-text">一、Kafka在zookeeper中存储结构图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、分析"><span class="toc-text">二、分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-topic注册信息"><span class="toc-text">2.1　topic注册信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-partition状态信息"><span class="toc-text">2.2　partition状态信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Broker注册信息"><span class="toc-text">2.3　Broker注册信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Controller-epoch"><span class="toc-text">2.4　Controller epoch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-Controller注册信息"><span class="toc-text">2.5　Controller注册信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-补充Consumer-and-Consumer-group"><span class="toc-text">2.6　补充Consumer and Consumer group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-Consumer均衡算法"><span class="toc-text">2.7　Consumer均衡算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-Consumer注册信息"><span class="toc-text">2.8　Consumer注册信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-Consumer-owner"><span class="toc-text">2.9　Consumer owner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-Consumer-offset"><span class="toc-text">2.10　Consumer offset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-Re-assign-partitions"><span class="toc-text">2.11　Re-assign partitions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-Preferred-replication-election"><span class="toc-text">2.12　Preferred replication election</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-13-删除topics"><span class="toc-text">2.13　删除topics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-14-Topic配置"><span class="toc-text">2.14　Topic配置</span></a></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
    访问量:
    <strong id="busuanzi_value_site_pv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    &nbsp; | &nbsp;
    访客数:
    <strong id="busuanzi_value_site_uv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2018
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/js/app.js?rev=@@hash"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":200,"height":350},"mobile":{"show":true}});</script></body>
</html>