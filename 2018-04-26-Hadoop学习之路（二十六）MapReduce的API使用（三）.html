<!DOCTYPE HTML>
<html lang="zh-CN">

<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="福星">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <meta name="theme-version" content="1.2.3">
    <meta name="root" content="/">
    <link rel="dns-prefetch" href="http://zhangfuxin.cn">
    <!--SEO-->

<meta name="keywords" content="Hadoop">


<meta name="description" content="** Hadoop学习之路（二十六）MapReduce的API使用（三）：** &lt;Excerpt in index | 首页摘要&gt;
​        Hadoop学习之路（二十六）M...">


<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->

<title>
    
    Hadoop学习之路（二十六）MapReduce的API使用（三） |
    
    福星
</title>

<link rel="alternate" href="/atom.xml" title="福星" type="application/atom+xml">


<link rel="icon" href="/favicon.ico">

    

<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.7.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">
    
<div class="hide">
    <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script>
</div>




    

<script>
(function() {
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</head></html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->
<body>
    <header class="main-header"  style="background-image:url(
    http://snippet.shenliyang.com/img/banner.jpg)"
     >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='福 星'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
            <!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
            <img src="/img/branding.png" alt="Snippet 博客主题" class="img-responsive center-block">
            
        </div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                        <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://zhangfuxin.cn">
                        福星</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                        <li role="presentation" class="text-center">
                            <a href="/"><i class="fa "></i>
                                首页</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Linux/"><i class="fa "></i>
                                Linux</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Hadoop/"><i class="fa "></i>
                                Hadoop</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Spark/"><i class="fa "></i>
                                Spark</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Java/"><i class="fa "></i>
                                Java</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/Python/"><i class="fa "></i>
                                Python</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/algorithm/"><i class="fa "></i>
                                算法</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/categories/工具/"><i class="fa "></i>
                                工具</a>
                        </li>
                        
                        <li role="presentation" class="text-center">
                            <a href="/archives/"><i class="fa "></i>
                                时间轴</a>
                        </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Hadoop学习之路（二十六）MapReduce的API使用（三）">
            
            Hadoop学习之路（二十六）MapReduce的API使用（三）
            
        </h1>
        <div class="post-meta">
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a class="category-link" href="/categories/Hadoop/">Hadoop</a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a class="tag-link" href="/tags/Hadoop/">Hadoop</a>
            
        </span>
    </span>
    
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">
            2018/04/26</span>
    </span>
    
    <span class="fa-wrap">
        <i class="fa fa-eye"></i>
        <span id="busuanzi_value_page_pv"></span>
    </span>
    
    
</div>
        
        
    </div>
    
    <div class="post-body post-content">
        <p>** Hadoop学习之路（二十六）MapReduce的API使用（三）：** &lt;Excerpt in index | 首页摘要&gt;</p>
<p>​        Hadoop学习之路（二十六）MapReduce的API使用（三）</p>
<a id="more"></a>
<p>&lt;The rest of contents | 余下全文&gt;</p>
<h2 id="数据及需求"><a href="#数据及需求" class="headerlink" title="数据及需求"></a>数据及需求</h2><h3 id="数据格式"><a href="#数据格式" class="headerlink" title="数据格式"></a>数据格式</h3><p>movies.dat　　3884条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1::Toy Story (1995)::Animation|Children&apos;s|Comedy</span><br><span class="line">2::Jumanji (1995)::Adventure|Children&apos;s|Fantasy</span><br><span class="line">3::Grumpier Old Men (1995)::Comedy|Romance</span><br><span class="line">4::Waiting to Exhale (1995)::Comedy|Drama</span><br><span class="line">5::Father of the Bride Part II (1995)::Comedy</span><br><span class="line">6::Heat (1995)::Action|Crime|Thriller</span><br><span class="line">7::Sabrina (1995)::Comedy|Romance</span><br><span class="line">8::Tom and Huck (1995)::Adventure|Children&apos;s</span><br><span class="line">9::Sudden Death (1995)::Action</span><br><span class="line">10::GoldenEye (1995)::Action|Adventure|Thriller</span><br></pre></td></tr></table></figure>

<p>users.dat　　6041条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1::F::1::10::48067</span><br><span class="line">2::M::56::16::70072</span><br><span class="line">3::M::25::15::55117</span><br><span class="line">4::M::45::7::02460</span><br><span class="line">5::M::25::20::55455</span><br><span class="line">6::F::50::9::55117</span><br><span class="line">7::M::35::1::06810</span><br><span class="line">8::M::25::12::11413</span><br><span class="line">9::M::25::17::61614</span><br><span class="line">10::F::35::1::95370</span><br></pre></td></tr></table></figure>

<p>ratings.dat　　1000210条数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1::1193::5::978300760</span><br><span class="line">1::661::3::978302109</span><br><span class="line">1::914::3::978301968</span><br><span class="line">1::3408::4::978300275</span><br><span class="line">1::2355::5::978824291</span><br><span class="line">1::1197::3::978302268</span><br><span class="line">1::1287::5::978302039</span><br><span class="line">1::2804::5::978300719</span><br><span class="line">1::594::4::978302268</span><br><span class="line">1::919::4::978301368</span><br></pre></td></tr></table></figure>

<h3 id="数据解释"><a href="#数据解释" class="headerlink" title="数据解释"></a>数据解释</h3><p>1、users.dat 数据格式为： 2::M::56::16::70072<br>对应字段为：UserID BigInt, Gender String, Age Int, Occupation String, Zipcode String<br>对应字段中文解释：用户id，性别，年龄，职业，邮政编码</p>
<p>2、movies.dat    数据格式为： 2::Jumanji (1995)::Adventure|Children’s|Fantasy<br>对应字段为：MovieID BigInt, Title String, Genres String<br>对应字段中文解释：电影ID，电影名字，电影类型</p>
<p>3、ratings.dat    数据格式为： 1::1193::5::978300760<br>对应字段为：UserID BigInt, MovieID BigInt, Rating Double, Timestamped String<br>对应字段中文解释：用户ID，电影ID，评分，评分时间戳</p>
<p>用户ID，电影ID，评分，评分时间戳，性别，年龄，职业，邮政编码，电影名字，电影类型<br>userid, movieId, rate, ts, gender, age, occupation, zipcode, movieName, movieType</p>
<h3 id="需求统计"><a href="#需求统计" class="headerlink" title="需求统计"></a>需求统计</h3><p>（1）求被评分次数最多的10部电影，并给出评分次数（电影名，评分次数）<br>（2）分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）<br>（3）求movieid = 2116这部电影各年龄段（因为年龄就只有7个，就按这个7个分就好了）的平均影评（年龄段，评分）<br>（4）求最喜欢看电影（影评次数最多）的那位女性评最高分的10部电影的平均影评分（人，电影名，影评）<br>（5）求好片（评分&gt;=4.0）最多的那个年份的最好看的10部电影<br>（6）求1997年上映的电影中，评分最高的10部Comedy类电影<br>（7）该影评库中各种类型电影中评价最高的5部电影（类型，电影名，平均影评分）<br>（8）各年评分最高的电影类型（年份，类型，影评分）<br>（9）每个地区最高评分的电影名，把结果存入HDFS（地区，电影名，电影评分）</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="1、求被评分次数最多的10部电影，并给出评分次数（电影名，评分次数）"><a href="#1、求被评分次数最多的10部电影，并给出评分次数（电影名，评分次数）" class="headerlink" title="1、求被评分次数最多的10部电影，并给出评分次数（电影名，评分次数）"></a>1、求被评分次数最多的10部电影，并给出评分次数（电影名，评分次数）</h3><p>分析：此问题涉及到2个文件，ratings.dat和movies.dat，2个文件数据量倾斜比较严重，此处应该使用mapjoin方法，先将数据量较小的文件预先加载到内存中</p>
<p>MovieMR1_1.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">  1 public class MovieMR1_1 &#123;</span><br><span class="line">  2 </span><br><span class="line">  3     public static void main(String[] args) throws Exception &#123;</span><br><span class="line">  4         </span><br><span class="line">  5         if(args.length &lt; 4) &#123;</span><br><span class="line">  6             args = new String[4];</span><br><span class="line">  7             args[0] = &quot;/movie/input/&quot;;</span><br><span class="line">  8             args[1] = &quot;/movie/output/&quot;;</span><br><span class="line">  9             args[2] = &quot;/movie/cache/movies.dat&quot;;</span><br><span class="line"> 10             args[3] = &quot;/movie/output_last/&quot;;</span><br><span class="line"> 11         &#125;</span><br><span class="line"> 12         </span><br><span class="line"> 13         </span><br><span class="line"> 14         Configuration conf1 = new Configuration();</span><br><span class="line"> 15         conf1.set(&quot;fs.defaultFS&quot;, &quot;hdfs://hadoop1:9000/&quot;);</span><br><span class="line"> 16         System.setProperty(&quot;HADOOP_USER_NAME&quot;, &quot;hadoop&quot;);</span><br><span class="line"> 17         FileSystem fs1 = FileSystem.get(conf1);</span><br><span class="line"> 18         </span><br><span class="line"> 19         </span><br><span class="line"> 20         Job job1 = Job.getInstance(conf1);</span><br><span class="line"> 21         </span><br><span class="line"> 22         job1.setJarByClass(MovieMR1_1.class);</span><br><span class="line"> 23         </span><br><span class="line"> 24         job1.setMapperClass(MoviesMapJoinRatingsMapper1.class);</span><br><span class="line"> 25         job1.setReducerClass(MovieMR1Reducer1.class);</span><br><span class="line"> 26         </span><br><span class="line"> 27         job1.setMapOutputKeyClass(Text.class);</span><br><span class="line"> 28         job1.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"> 29         </span><br><span class="line"> 30         job1.setOutputKeyClass(Text.class);</span><br><span class="line"> 31         job1.setOutputValueClass(IntWritable.class);</span><br><span class="line"> 32         </span><br><span class="line"> 33         </span><br><span class="line"> 34         </span><br><span class="line"> 35         //缓存普通文件到task运行节点的工作目录</span><br><span class="line"> 36         URI uri = new URI(&quot;hdfs://hadoop1:9000&quot;+args[2]);</span><br><span class="line"> 37         System.out.println(uri);</span><br><span class="line"> 38         job1.addCacheFile(uri);</span><br><span class="line"> 39         </span><br><span class="line"> 40         </span><br><span class="line"> 41         Path inputPath1 = new Path(args[0]);</span><br><span class="line"> 42         Path outputPath1 = new Path(args[1]);</span><br><span class="line"> 43         if(fs1.exists(outputPath1)) &#123;</span><br><span class="line"> 44             fs1.delete(outputPath1, true);</span><br><span class="line"> 45         &#125;</span><br><span class="line"> 46         FileInputFormat.setInputPaths(job1, inputPath1);</span><br><span class="line"> 47         FileOutputFormat.setOutputPath(job1, outputPath1);</span><br><span class="line"> 48         </span><br><span class="line"> 49         boolean isDone = job1.waitForCompletion(true);</span><br><span class="line"> 50         System.exit(isDone ? 0 : 1);</span><br><span class="line"> 51        </span><br><span class="line"> 52     &#125;</span><br><span class="line"> 53     </span><br><span class="line"> 54     public static class MoviesMapJoinRatingsMapper1 extends Mapper&lt;LongWritable, Text, Text, IntWritable&gt;&#123;</span><br><span class="line"> 55         </span><br><span class="line"> 56         //用了存放加载到内存中的movies.dat数据</span><br><span class="line"> 57         private static Map&lt;String,String&gt; movieMap =  new HashMap&lt;&gt;();</span><br><span class="line"> 58         //key：电影ID</span><br><span class="line"> 59         Text outKey = new Text();</span><br><span class="line"> 60         //value：电影名+电影类型</span><br><span class="line"> 61         IntWritable outValue = new IntWritable();</span><br><span class="line"> 62         </span><br><span class="line"> 63         </span><br><span class="line"> 64         /**</span><br><span class="line"> 65          * movies.dat:    1::Toy Story (1995)::Animation|Children&apos;s|Comedy</span><br><span class="line"> 66          * </span><br><span class="line"> 67          * </span><br><span class="line"> 68          * 将小表(movies.dat)中的数据预先加载到内存中去</span><br><span class="line"> 69          * */</span><br><span class="line"> 70         @Override</span><br><span class="line"> 71         protected void setup(Context context) throws IOException, InterruptedException &#123;</span><br><span class="line"> 72             </span><br><span class="line"> 73             Path[] localCacheFiles = context.getLocalCacheFiles();</span><br><span class="line"> 74             </span><br><span class="line"> 75             </span><br><span class="line"> 76             String strPath = localCacheFiles[0].toUri().toString();</span><br><span class="line"> 77             </span><br><span class="line"> 78             BufferedReader br = new BufferedReader(new FileReader(strPath));</span><br><span class="line"> 79             String readLine;</span><br><span class="line"> 80             while((readLine = br.readLine()) != null) &#123;</span><br><span class="line"> 81                 </span><br><span class="line"> 82                 String[] split = readLine.split(&quot;::&quot;);</span><br><span class="line"> 83                 String movieId = split[0];</span><br><span class="line"> 84                 String movieName = split[1];</span><br><span class="line"> 85                 String movieType = split[2];</span><br><span class="line"> 86                 </span><br><span class="line"> 87                 movieMap.put(movieId, movieName+&quot;\t&quot;+movieType);</span><br><span class="line"> 88             &#125;</span><br><span class="line"> 89             </span><br><span class="line"> 90             br.close();</span><br><span class="line"> 91         &#125;</span><br><span class="line"> 92         </span><br><span class="line"> 93         </span><br><span class="line"> 94         /**</span><br><span class="line"> 95          * movies.dat:    1    ::    Toy Story (1995)    ::    Animation|Children&apos;s|Comedy    </span><br><span class="line"> 96          *                 电影ID    电影名字                    电影类型</span><br><span class="line"> 97          * </span><br><span class="line"> 98          * ratings.dat:    1    ::    1193    ::    5    ::    978300760</span><br><span class="line"> 99          *                 用户ID    电影ID        评分        评分时间戳</span><br><span class="line">100          * </span><br><span class="line">101          * value:    ratings.dat读取的数据</span><br><span class="line">102          * */</span><br><span class="line">103         @Override</span><br><span class="line">104         protected void map(LongWritable key, Text value, Context context)</span><br><span class="line">105                 throws IOException, InterruptedException &#123;</span><br><span class="line">106             </span><br><span class="line">107             String[] split = value.toString().split(&quot;::&quot;);</span><br><span class="line">108             </span><br><span class="line">109             String userId = split[0];</span><br><span class="line">110             String movieId = split[1];</span><br><span class="line">111             String movieRate = split[2];</span><br><span class="line">112             </span><br><span class="line">113             //根据movieId从内存中获取电影名和类型</span><br><span class="line">114             String movieNameAndType = movieMap.get(movieId);</span><br><span class="line">115             String movieName = movieNameAndType.split(&quot;\t&quot;)[0];</span><br><span class="line">116             String movieType = movieNameAndType.split(&quot;\t&quot;)[1];</span><br><span class="line">117             </span><br><span class="line">118             outKey.set(movieName);</span><br><span class="line">119             outValue.set(Integer.parseInt(movieRate));</span><br><span class="line">120             </span><br><span class="line">121             context.write(outKey, outValue);</span><br><span class="line">122             </span><br><span class="line">123         &#125;</span><br><span class="line">124             </span><br><span class="line">125     &#125;</span><br><span class="line">126 </span><br><span class="line">127     </span><br><span class="line">128     public static class MovieMR1Reducer1 extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt;&#123;</span><br><span class="line">129         //每部电影评论的次数</span><br><span class="line">130         int count;</span><br><span class="line">131         //评分次数</span><br><span class="line">132         IntWritable outValue = new IntWritable();</span><br><span class="line">133         </span><br><span class="line">134         @Override</span><br><span class="line">135         protected void reduce(Text key, Iterable&lt;IntWritable&gt; values,Context context) throws IOException, InterruptedException &#123;</span><br><span class="line">136             </span><br><span class="line">137             count = 0;</span><br><span class="line">138             </span><br><span class="line">139             for(IntWritable value : values) &#123;</span><br><span class="line">140                 count++;</span><br><span class="line">141             &#125;</span><br><span class="line">142             </span><br><span class="line">143             outValue.set(count);</span><br><span class="line">144             </span><br><span class="line">145             context.write(key, outValue);</span><br><span class="line">146         &#125;</span><br><span class="line">147         </span><br><span class="line">148     &#125;</span><br><span class="line">149     </span><br><span class="line">150     </span><br><span class="line">151 &#125;</span><br></pre></td></tr></table></figure>

<p>MovieMR1_2.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"> 1 public class MovieMR1_2 &#123;</span><br><span class="line"> 2 </span><br><span class="line"> 3     public static void main(String[] args) throws Exception &#123;</span><br><span class="line"> 4         if(args.length &lt; 2) &#123;</span><br><span class="line"> 5             args = new String[2];</span><br><span class="line"> 6             args[0] = &quot;/movie/output/&quot;;</span><br><span class="line"> 7             args[1] = &quot;/movie/output_last/&quot;;</span><br><span class="line"> 8         &#125;</span><br><span class="line"> 9         </span><br><span class="line">10         </span><br><span class="line">11         Configuration conf1 = new Configuration();</span><br><span class="line">12         conf1.set(&quot;fs.defaultFS&quot;, &quot;hdfs://hadoop1:9000/&quot;);</span><br><span class="line">13         System.setProperty(&quot;HADOOP_USER_NAME&quot;, &quot;hadoop&quot;);</span><br><span class="line">14         FileSystem fs1 = FileSystem.get(conf1);</span><br><span class="line">15         </span><br><span class="line">16         </span><br><span class="line">17         Job job = Job.getInstance(conf1);</span><br><span class="line">18         </span><br><span class="line">19         job.setJarByClass(MovieMR1_2.class);</span><br><span class="line">20         </span><br><span class="line">21         job.setMapperClass(MoviesMapJoinRatingsMapper2.class);</span><br><span class="line">22         job.setReducerClass(MovieMR1Reducer2.class);</span><br><span class="line">23 </span><br><span class="line">24         </span><br><span class="line">25         job.setMapOutputKeyClass(MovieRating.class);</span><br><span class="line">26         job.setMapOutputValueClass(NullWritable.class);</span><br><span class="line">27         </span><br><span class="line">28         job.setOutputKeyClass(MovieRating.class);</span><br><span class="line">29         job.setOutputValueClass(NullWritable.class);</span><br><span class="line">30         </span><br><span class="line">31         </span><br><span class="line">32         Path inputPath1 = new Path(args[0]);</span><br><span class="line">33         Path outputPath1 = new Path(args[1]);</span><br><span class="line">34         if(fs1.exists(outputPath1)) &#123;</span><br><span class="line">35             fs1.delete(outputPath1, true);</span><br><span class="line">36         &#125;</span><br><span class="line">37         //对第一步的输出结果进行降序排序</span><br><span class="line">38         FileInputFormat.setInputPaths(job, inputPath1);</span><br><span class="line">39         FileOutputFormat.setOutputPath(job, outputPath1);</span><br><span class="line">40         </span><br><span class="line">41         boolean isDone = job.waitForCompletion(true);</span><br><span class="line">42         System.exit(isDone ? 0 : 1);</span><br><span class="line">43         </span><br><span class="line">44 </span><br><span class="line">45     &#125;</span><br><span class="line">46     </span><br><span class="line">47     //注意输出类型为自定义对象MovieRating，MovieRating按照降序排序</span><br><span class="line">48     public static class MoviesMapJoinRatingsMapper2 extends Mapper&lt;LongWritable, Text, MovieRating, NullWritable&gt;&#123;</span><br><span class="line">49         </span><br><span class="line">50         MovieRating outKey = new MovieRating();</span><br><span class="line">51         </span><br><span class="line">52         @Override</span><br><span class="line">53         protected void map(LongWritable key, Text value, Context context)</span><br><span class="line">54                 throws IOException, InterruptedException &#123;</span><br><span class="line">55             //&apos;Night Mother (1986)         70</span><br><span class="line">56             String[] split = value.toString().split(&quot;\t&quot;);</span><br><span class="line">57             </span><br><span class="line">58             outKey.setCount(Integer.parseInt(split[1]));;</span><br><span class="line">59             outKey.setMovieName(split[0]);</span><br><span class="line">60             </span><br><span class="line">61             context.write(outKey, NullWritable.get());</span><br><span class="line">62                         </span><br><span class="line">63         &#125;</span><br><span class="line">64                 </span><br><span class="line">65     &#125;</span><br><span class="line">66     </span><br><span class="line">67     //排序之后自然输出，只取前10部电影</span><br><span class="line">68     public static class MovieMR1Reducer2 extends Reducer&lt;MovieRating, NullWritable, MovieRating, NullWritable&gt;&#123;</span><br><span class="line">69         </span><br><span class="line">70         Text outKey = new Text();</span><br><span class="line">71         int count = 0;</span><br><span class="line">72         </span><br><span class="line">73         @Override</span><br><span class="line">74         protected void reduce(MovieRating key, Iterable&lt;NullWritable&gt; values,Context context) throws IOException, InterruptedException &#123;</span><br><span class="line">75 </span><br><span class="line">76             for(NullWritable value : values) &#123;</span><br><span class="line">77                 count++;</span><br><span class="line">78                 if(count &gt; 10) &#123;</span><br><span class="line">79                     return;</span><br><span class="line">80                 &#125;</span><br><span class="line">81                 context.write(key, value);</span><br><span class="line">82                 </span><br><span class="line">83             &#125;</span><br><span class="line">84         </span><br><span class="line">85         &#125;</span><br><span class="line">86         </span><br><span class="line">87     &#125;</span><br><span class="line">88 &#125;</span><br></pre></td></tr></table></figure>

<p>MovieRating.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> 1 public class MovieRating implements WritableComparable&lt;MovieRating&gt;&#123;</span><br><span class="line"> 2     private String movieName;</span><br><span class="line"> 3     private int count;</span><br><span class="line"> 4     </span><br><span class="line"> 5     public String getMovieName() &#123;</span><br><span class="line"> 6         return movieName;</span><br><span class="line"> 7     &#125;</span><br><span class="line"> 8     public void setMovieName(String movieName) &#123;</span><br><span class="line"> 9         this.movieName = movieName;</span><br><span class="line">10     &#125;</span><br><span class="line">11     public int getCount() &#123;</span><br><span class="line">12         return count;</span><br><span class="line">13     &#125;</span><br><span class="line">14     public void setCount(int count) &#123;</span><br><span class="line">15         this.count = count;</span><br><span class="line">16     &#125;</span><br><span class="line">17     </span><br><span class="line">18     public MovieRating() &#123;&#125;</span><br><span class="line">19     </span><br><span class="line">20     public MovieRating(String movieName, int count) &#123;</span><br><span class="line">21         super();</span><br><span class="line">22         this.movieName = movieName;</span><br><span class="line">23         this.count = count;</span><br><span class="line">24     &#125;</span><br><span class="line">25     </span><br><span class="line">26     </span><br><span class="line">27     @Override</span><br><span class="line">28     public String toString() &#123;</span><br><span class="line">29         return  movieName + &quot;\t&quot; + count;</span><br><span class="line">30     &#125;</span><br><span class="line">31     @Override</span><br><span class="line">32     public void readFields(DataInput in) throws IOException &#123;</span><br><span class="line">33         movieName = in.readUTF();</span><br><span class="line">34         count = in.readInt();</span><br><span class="line">35     &#125;</span><br><span class="line">36     @Override</span><br><span class="line">37     public void write(DataOutput out) throws IOException &#123;</span><br><span class="line">38         out.writeUTF(movieName);</span><br><span class="line">39         out.writeInt(count);</span><br><span class="line">40     &#125;</span><br><span class="line">41     @Override</span><br><span class="line">42     public int compareTo(MovieRating o) &#123;</span><br><span class="line">43         return o.count - this.count ;</span><br><span class="line">44     &#125;</span><br><span class="line">45     </span><br><span class="line">46 &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2、分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）"><a href="#2、分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）" class="headerlink" title="2、分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）"></a>2、分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）</h3><p>分析：此问题涉及到3个表的联合查询，需要先将2个小表的数据预先加载到内存中，再进行查询</p>
<p>对三表进行联合</p>
<p>MoviesThreeTableJoin.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">  1 /**</span><br><span class="line">  2  * 进行3表的联合查询</span><br><span class="line">  3  * </span><br><span class="line">  4  * */</span><br><span class="line">  5 public class MoviesThreeTableJoin &#123;</span><br><span class="line">  6 </span><br><span class="line">  7     public static void main(String[] args) throws Exception &#123;</span><br><span class="line">  8         </span><br><span class="line">  9         if(args.length &lt; 4) &#123;</span><br><span class="line"> 10             args = new String[4];</span><br><span class="line"> 11             args[0] = &quot;/movie/input/&quot;;</span><br><span class="line"> 12             args[1] = &quot;/movie/output2/&quot;;</span><br><span class="line"> 13             args[2] = &quot;/movie/cache/movies.dat&quot;;</span><br><span class="line"> 14             args[3] = &quot;/movie/cache/users.dat&quot;;</span><br><span class="line"> 15         &#125;</span><br><span class="line"> 16         </span><br><span class="line"> 17         Configuration conf = new Configuration();</span><br><span class="line"> 18         conf.set(&quot;fs.defaultFS&quot;, &quot;hdfs://hadoop1:9000/&quot;);</span><br><span class="line"> 19         System.setProperty(&quot;HADOOP_USER_NAME&quot;, &quot;hadoop&quot;);</span><br><span class="line"> 20         FileSystem fs = FileSystem.get(conf);</span><br><span class="line"> 21         Job job = Job.getInstance(conf);</span><br><span class="line"> 22         </span><br><span class="line"> 23         job.setJarByClass(MoviesThreeTableJoin.class);</span><br><span class="line"> 24         job.setMapperClass(ThreeTableMapper.class);</span><br><span class="line"> 25         </span><br><span class="line"> 26         job.setOutputKeyClass(Text.class);</span><br><span class="line"> 27         job.setOutputValueClass(NullWritable.class);</span><br><span class="line"> 28         </span><br><span class="line"> 29         URI uriUsers = new URI(&quot;hdfs://hadoop1:9000&quot;+args[3]);</span><br><span class="line"> 30         URI uriMovies = new URI(&quot;hdfs://hadoop1:9000&quot;+args[2]);</span><br><span class="line"> 31         job.addCacheFile(uriUsers);</span><br><span class="line"> 32         job.addCacheFile(uriMovies);</span><br><span class="line"> 33         </span><br><span class="line"> 34         Path inputPath = new Path(args[0]);</span><br><span class="line"> 35         Path outputPath = new Path(args[1]);</span><br><span class="line"> 36         </span><br><span class="line"> 37         if(fs.exists(outputPath)) &#123;</span><br><span class="line"> 38             fs.delete(outputPath,true);</span><br><span class="line"> 39         &#125;</span><br><span class="line"> 40         </span><br><span class="line"> 41         FileInputFormat.setInputPaths(job, inputPath);</span><br><span class="line"> 42         FileOutputFormat.setOutputPath(job, outputPath);</span><br><span class="line"> 43         </span><br><span class="line"> 44         boolean isDone = job.waitForCompletion(true);</span><br><span class="line"> 45         System.exit(isDone ? 0 : 1);</span><br><span class="line"> 46         </span><br><span class="line"> 47     &#125;</span><br><span class="line"> 48 </span><br><span class="line"> 49     </span><br><span class="line"> 50     public static class ThreeTableMapper extends Mapper&lt;LongWritable, Text, Text, NullWritable&gt;&#123;</span><br><span class="line"> 51         </span><br><span class="line"> 52         </span><br><span class="line"> 53         //用于缓存movies和users中数据</span><br><span class="line"> 54         private Map&lt;String,String&gt; moviesMap = new HashMap&lt;&gt;();</span><br><span class="line"> 55         private Map&lt;String,String&gt; usersMap = new HashMap&lt;&gt;();</span><br><span class="line"> 56         //用来存放读取的ratings.dat中的一行数据</span><br><span class="line"> 57         String[] ratings;</span><br><span class="line"> 58         </span><br><span class="line"> 59         </span><br><span class="line"> 60         Text outKey = new Text();</span><br><span class="line"> 61         </span><br><span class="line"> 62         @Override</span><br><span class="line"> 63         protected void setup(Context context) throws IOException, InterruptedException &#123;</span><br><span class="line"> 64             </span><br><span class="line"> 65             BufferedReader br = null;</span><br><span class="line"> 66             </span><br><span class="line"> 67             Path[] paths = context.getLocalCacheFiles();</span><br><span class="line"> 68             String usersLine = null;</span><br><span class="line"> 69             String moviesLine = null;</span><br><span class="line"> 70             </span><br><span class="line"> 71             for(Path path : paths) &#123;</span><br><span class="line"> 72                 String name = path.toUri().getPath();</span><br><span class="line"> 73                 if(name.contains(&quot;movies.dat&quot;)) &#123;</span><br><span class="line"> 74                     //读取movies.dat文件中的一行数据</span><br><span class="line"> 75                     br = new BufferedReader(new FileReader(name));</span><br><span class="line"> 76                     while((moviesLine = br.readLine()) != null) &#123;</span><br><span class="line"> 77                         /**对读取的这行数据按照：：进行切分</span><br><span class="line"> 78                         *    2::Jumanji (1995)::Adventure|Children&apos;s|Fantasy</span><br><span class="line"> 79                         *    电影ID，电影名字，电影类型</span><br><span class="line"> 80                         *</span><br><span class="line"> 81                         *电影ID作为key，其余作为value</span><br><span class="line"> 82                         */</span><br><span class="line"> 83                         String[] split = moviesLine.split(&quot;::&quot;);</span><br><span class="line"> 84                         moviesMap.put(split[0], split[1]+&quot;::&quot;+split[2]);</span><br><span class="line"> 85                     &#125;        </span><br><span class="line"> 86                 &#125;else if(name.contains(&quot;users.dat&quot;)) &#123;</span><br><span class="line"> 87                     //读取users.dat文件中的一行数据</span><br><span class="line"> 88                     br = new BufferedReader(new FileReader(name));</span><br><span class="line"> 89                     while((usersLine = br.readLine()) != null) &#123;</span><br><span class="line"> 90                         /**</span><br><span class="line"> 91                          * 对读取的这行数据按照：：进行切分</span><br><span class="line"> 92                          * 2::M::56::16::70072</span><br><span class="line"> 93                          * 用户id，性别，年龄，职业，邮政编码</span><br><span class="line"> 94                          * </span><br><span class="line"> 95                          * 用户ID作为key，其他的作为value</span><br><span class="line"> 96                          * */</span><br><span class="line"> 97                         String[] split = usersLine.split(&quot;::&quot;);</span><br><span class="line"> 98                         System.out.println(split[0]+&quot;----&quot;+split[1]);</span><br><span class="line"> 99                         usersMap.put(split[0], split[1]+&quot;::&quot;+split[2]+&quot;::&quot;+split[3]+&quot;::&quot;+split[4]);</span><br><span class="line">100                     &#125;</span><br><span class="line">101                 &#125;</span><br><span class="line">102             </span><br><span class="line">103             &#125;</span><br><span class="line">104         </span><br><span class="line">105         &#125;</span><br><span class="line">106         </span><br><span class="line">107         </span><br><span class="line">108         @Override</span><br><span class="line">109         protected void map(LongWritable key, Text value, Context context)</span><br><span class="line">110                 throws IOException, InterruptedException &#123;</span><br><span class="line">111             </span><br><span class="line">112             ratings = value.toString().split(&quot;::&quot;);</span><br><span class="line">113             //通过电影ID和用户ID获取用户表和电影表中的其他信息</span><br><span class="line">114             String movies = moviesMap.get(ratings[1]);</span><br><span class="line">115             String users = usersMap.get(ratings[0]);</span><br><span class="line">116             </span><br><span class="line">117             //三表信息的联合</span><br><span class="line">118             String threeTables = value.toString()+&quot;::&quot;+movies+&quot;::&quot;+users;</span><br><span class="line">119             outKey.set(threeTables);</span><br><span class="line">120             </span><br><span class="line">121             context.write(outKey, NullWritable.get());</span><br><span class="line">122         &#125;</span><br><span class="line">123     &#125;</span><br><span class="line">124     </span><br><span class="line">125     </span><br><span class="line">126 &#125;</span><br></pre></td></tr></table></figure>

<p>三表联合之后的数据为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1000::1023::5::975041651::Winnie the Pooh and the Blustery Day (1968)::Animation|Children&apos;s::F::25::6::90027</span><br><span class="line">1000::1029::3::975041859::Dumbo (1941)::Animation|Children&apos;s|Musical::F::25::6::90027</span><br><span class="line">1000::1036::4::975040964::Die Hard (1988)::Action|Thriller::F::25::6::90027</span><br><span class="line">1000::1104::5::975042421::Streetcar Named Desire, A (1951)::Drama::F::25::6::90027</span><br><span class="line">1000::110::5::975040841::Braveheart (1995)::Action|Drama|War::F::25::6::90027</span><br><span class="line">1000::1196::3::975040841::Star Wars: Episode V - The Empire Strikes Back (1980)::Action|Adventure|Drama|Sci-Fi|War::F::25::6::90027</span><br><span class="line">1000::1198::5::975040841::Raiders of the Lost Ark (1981)::Action|Adventure::F::25::6::90027</span><br><span class="line">1000::1200::4::975041125::Aliens (1986)::Action|Sci-Fi|Thriller|War::F::25::6::90027</span><br><span class="line">1000::1201::5::975041025::Good, The Bad and The Ugly, The (1966)::Action|Western::F::25::6::90027</span><br><span class="line">1000::1210::5::975040629::Star Wars: Episode VI - Return of the Jedi (1983)::Action|Adventure|Romance|Sci-Fi|War::F::25::6::90027</span><br></pre></td></tr></table></figure>

<p>字段解释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1000    ::    1036    ::    4    ::    975040964    ::    Die Hard (1988)    ::    Action|Thriller    ::    F    ::    25    ::    6    ::    90027</span><br><span class="line"></span><br><span class="line">用户ID        电影ID        评分     　　 评分时间戳             电影名字                  电影类型                性别        年龄        职业        邮政编码0　　　　　　　　1　　　　　　　　2　　　　　　　　3　　　　　　　　　　　　4　　　　　　　　　　　　　　5　　　　　　　　　　　　6　　　　　　7　　　　　　8　　　　　　   9</span><br></pre></td></tr></table></figure>

<p> 要分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）</p>
<p>1、以性别和电影名分组，以电影名+性别为key，以评分为value进行计算；</p>
<p>2、以性别+电影名+评分作为对象，以性别分组，以评分降序进行输出TOP10</p>
<p>业务逻辑：MoviesDemo2.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">  1 public class MoviesDemo2 &#123;</span><br><span class="line">  2 </span><br><span class="line">  3     public static void main(String[] args) throws Exception &#123;</span><br><span class="line">  4         </span><br><span class="line">  5         Configuration conf1 = new Configuration();</span><br><span class="line">  6         Configuration conf2 = new Configuration();</span><br><span class="line">  7         FileSystem fs1 = FileSystem.get(conf1);</span><br><span class="line">  8         FileSystem fs2 = FileSystem.get(conf2);</span><br><span class="line">  9         Job job1 = Job.getInstance(conf1);</span><br><span class="line"> 10         Job job2 = Job.getInstance(conf2);</span><br><span class="line"> 11         </span><br><span class="line"> 12         job1.setJarByClass(MoviesDemo2.class);</span><br><span class="line"> 13         job1.setMapperClass(MoviesDemo2Mapper1.class);</span><br><span class="line"> 14         job2.setMapperClass(MoviesDemo2Mapper2.class);</span><br><span class="line"> 15         job1.setReducerClass(MoviesDemo2Reducer1.class);</span><br><span class="line"> 16         job2.setReducerClass(MoviesDemo2Reducer2.class);</span><br><span class="line"> 17         </span><br><span class="line"> 18         job1.setOutputKeyClass(Text.class);</span><br><span class="line"> 19         job1.setOutputValueClass(DoubleWritable.class);</span><br><span class="line"> 20         </span><br><span class="line"> 21         job2.setOutputKeyClass(MoviesSexBean.class);</span><br><span class="line"> 22         job2.setOutputValueClass(NullWritable.class);</span><br><span class="line"> 23         </span><br><span class="line"> 24         job2.setGroupingComparatorClass(MoviesSexGC.class);</span><br><span class="line"> 25         </span><br><span class="line"> 26         Path inputPath1 = new Path(&quot;D:\\MR\\hw\\movie\\output3he1&quot;);</span><br><span class="line"> 27         Path outputPath1 = new Path(&quot;D:\\MR\\hw\\movie\\output2_1&quot;);</span><br><span class="line"> 28         Path inputPath2 = new Path(&quot;D:\\MR\\hw\\movie\\output2_1&quot;);</span><br><span class="line"> 29         Path outputPath2 = new Path(&quot;D:\\MR\\hw\\movie\\output2_end&quot;);</span><br><span class="line"> 30         </span><br><span class="line"> 31         if(fs1.exists(outputPath1)) &#123;</span><br><span class="line"> 32             fs1.delete(outputPath1,true);</span><br><span class="line"> 33         &#125;</span><br><span class="line"> 34         if(fs2.exists(outputPath2)) &#123;</span><br><span class="line"> 35             fs2.delete(outputPath2,true);</span><br><span class="line"> 36         &#125;</span><br><span class="line"> 37         </span><br><span class="line"> 38         </span><br><span class="line"> 39         FileInputFormat.setInputPaths(job1, inputPath1);</span><br><span class="line"> 40         FileOutputFormat.setOutputPath(job1, outputPath1);</span><br><span class="line"> 41         </span><br><span class="line"> 42         FileInputFormat.setInputPaths(job2, inputPath2);</span><br><span class="line"> 43         FileOutputFormat.setOutputPath(job2, outputPath2);</span><br><span class="line"> 44         </span><br><span class="line"> 45         JobControl control = new JobControl(&quot;MoviesDemo2&quot;);</span><br><span class="line"> 46         </span><br><span class="line"> 47         ControlledJob aJob = new ControlledJob(job1.getConfiguration());</span><br><span class="line"> 48         ControlledJob bJob = new ControlledJob(job2.getConfiguration());</span><br><span class="line"> 49         </span><br><span class="line"> 50         bJob.addDependingJob(aJob);</span><br><span class="line"> 51         </span><br><span class="line"> 52         control.addJob(aJob);</span><br><span class="line"> 53         control.addJob(bJob);</span><br><span class="line"> 54         </span><br><span class="line"> 55         Thread thread = new Thread(control);</span><br><span class="line"> 56         thread.start();</span><br><span class="line"> 57         </span><br><span class="line"> 58         while(!control.allFinished()) &#123;</span><br><span class="line"> 59             thread.sleep(1000);</span><br><span class="line"> 60         &#125;</span><br><span class="line"> 61         System.exit(0);</span><br><span class="line"> 62         </span><br><span class="line"> 63         </span><br><span class="line"> 64     &#125;</span><br><span class="line"> 65     </span><br><span class="line"> 66     </span><br><span class="line"> 67     /**</span><br><span class="line"> 68      * 数据来源：3个文件关联之后的输出文件</span><br><span class="line"> 69      * 以电影名+性别为key，以评分为value进行输出</span><br><span class="line"> 70      * </span><br><span class="line"> 71      * 1000::1036::4::975040964::Die Hard (1988)::Action|Thriller::F::25::6::90027</span><br><span class="line"> 72      * </span><br><span class="line"> 73      * 用户ID::电影ID::评分::评分时间戳::电影名字::电影类型::性别::年龄::职业::邮政编码</span><br><span class="line"> 74      * </span><br><span class="line"> 75      * */</span><br><span class="line"> 76     public static class MoviesDemo2Mapper1 extends Mapper&lt;LongWritable, Text, Text, DoubleWritable&gt;&#123;</span><br><span class="line"> 77         </span><br><span class="line"> 78         Text outKey = new Text();</span><br><span class="line"> 79         DoubleWritable outValue = new DoubleWritable();</span><br><span class="line"> 80         </span><br><span class="line"> 81         @Override</span><br><span class="line"> 82         protected void map(LongWritable key, Text value,Context context)</span><br><span class="line"> 83                 throws IOException, InterruptedException &#123;</span><br><span class="line"> 84 </span><br><span class="line"> 85             String[] split = value.toString().split(&quot;::&quot;);</span><br><span class="line"> 86             String strKey = split[4]+&quot;\t&quot;+split[6];</span><br><span class="line"> 87             String strValue = split[2];</span><br><span class="line"> 88             </span><br><span class="line"> 89             outKey.set(strKey);</span><br><span class="line"> 90             outValue.set(Double.parseDouble(strValue));</span><br><span class="line"> 91             </span><br><span class="line"> 92             context.write(outKey, outValue);</span><br><span class="line"> 93         &#125;</span><br><span class="line"> 94         </span><br><span class="line"> 95     &#125;</span><br><span class="line"> 96     </span><br><span class="line"> 97     /**</span><br><span class="line"> 98      * 以电影名+性别为key，计算平均分</span><br><span class="line"> 99      * */</span><br><span class="line">100     public static class MoviesDemo2Reducer1 extends Reducer&lt;Text, DoubleWritable, Text, DoubleWritable&gt;&#123;</span><br><span class="line">101         </span><br><span class="line">102         DoubleWritable outValue = new DoubleWritable();</span><br><span class="line">103         </span><br><span class="line">104         @Override</span><br><span class="line">105         protected void reduce(Text key, Iterable&lt;DoubleWritable&gt; values,Context context)</span><br><span class="line">106                 throws IOException, InterruptedException &#123;</span><br><span class="line">107             </span><br><span class="line">108             int count = 0;</span><br><span class="line">109             double sum = 0;</span><br><span class="line">110             for(DoubleWritable value : values) &#123;</span><br><span class="line">111                 count++;</span><br><span class="line">112                 sum += Double.parseDouble(value.toString());</span><br><span class="line">113             &#125;</span><br><span class="line">114             double avg = sum / count;</span><br><span class="line">115             </span><br><span class="line">116             outValue.set(avg);</span><br><span class="line">117             context.write(key, outValue);</span><br><span class="line">118         &#125;</span><br><span class="line">119     &#125;</span><br><span class="line">120     </span><br><span class="line">121     /**</span><br><span class="line">122      * 以电影名+性别+评分作为对象，以性别分组，以评分降序排序</span><br><span class="line">123      * */</span><br><span class="line">124     public static class MoviesDemo2Mapper2 extends Mapper&lt;LongWritable, Text, MoviesSexBean, NullWritable&gt;&#123;</span><br><span class="line">125         </span><br><span class="line">126         MoviesSexBean outKey = new MoviesSexBean();</span><br><span class="line">127         </span><br><span class="line">128         @Override</span><br><span class="line">129         protected void map(LongWritable key, Text value,Context context)</span><br><span class="line">130                 throws IOException, InterruptedException &#123;</span><br><span class="line">131             </span><br><span class="line">132             String[] split = value.toString().split(&quot;\t&quot;);</span><br><span class="line">133             outKey.setMovieName(split[0]);</span><br><span class="line">134             outKey.setSex(split[1]);</span><br><span class="line">135             outKey.setScore(Double.parseDouble(split[2]));</span><br><span class="line">136             </span><br><span class="line">137             context.write(outKey, NullWritable.get());</span><br><span class="line">138         </span><br><span class="line">139         &#125;</span><br><span class="line">140     &#125;</span><br><span class="line">141     </span><br><span class="line">142     /**</span><br><span class="line">143      * 取性别男女各前10名评分最好的电影</span><br><span class="line">144      * */</span><br><span class="line">145     public static class MoviesDemo2Reducer2 extends Reducer&lt;MoviesSexBean, NullWritable, MoviesSexBean, NullWritable&gt;&#123;</span><br><span class="line">146         </span><br><span class="line">147         @Override</span><br><span class="line">148         protected void reduce(MoviesSexBean key, Iterable&lt;NullWritable&gt; values,Context context)</span><br><span class="line">149                 throws IOException, InterruptedException &#123;</span><br><span class="line">150             </span><br><span class="line">151             int count = 0;</span><br><span class="line">152             for(NullWritable nvl : values) &#123;</span><br><span class="line">153                 count++;</span><br><span class="line">154                 context.write(key, NullWritable.get());</span><br><span class="line">155                 if(count == 10) &#123;</span><br><span class="line">156                     return;</span><br><span class="line">157                 &#125;        </span><br><span class="line">158             &#125;</span><br><span class="line">159         </span><br><span class="line">160         &#125;</span><br><span class="line">161     &#125;</span><br><span class="line">162 &#125;</span><br></pre></td></tr></table></figure>

<p>对象：MoviesSexBean.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"> 1 public class MoviesSexBean implements WritableComparable&lt;MoviesSexBean&gt;&#123;</span><br><span class="line"> 2     </span><br><span class="line"> 3     private String movieName;</span><br><span class="line"> 4     private String sex;</span><br><span class="line"> 5     private double score;</span><br><span class="line"> 6     </span><br><span class="line"> 7     public MoviesSexBean() &#123;</span><br><span class="line"> 8         super();</span><br><span class="line"> 9     &#125;</span><br><span class="line">10     public MoviesSexBean(String movieName, String sex, double score) &#123;</span><br><span class="line">11         super();</span><br><span class="line">12         this.movieName = movieName;</span><br><span class="line">13         this.sex = sex;</span><br><span class="line">14         this.score = score;</span><br><span class="line">15     &#125;</span><br><span class="line">16     public String getMovieName() &#123;</span><br><span class="line">17         return movieName;</span><br><span class="line">18     &#125;</span><br><span class="line">19     public void setMovieName(String movieName) &#123;</span><br><span class="line">20         this.movieName = movieName;</span><br><span class="line">21     &#125;</span><br><span class="line">22     public String getSex() &#123;</span><br><span class="line">23         return sex;</span><br><span class="line">24     &#125;</span><br><span class="line">25     public void setSex(String sex) &#123;</span><br><span class="line">26         this.sex = sex;</span><br><span class="line">27     &#125;</span><br><span class="line">28     public double getScore() &#123;</span><br><span class="line">29         return score;</span><br><span class="line">30     &#125;</span><br><span class="line">31     public void setScore(double score) &#123;</span><br><span class="line">32         this.score = score;</span><br><span class="line">33     &#125;</span><br><span class="line">34     @Override</span><br><span class="line">35     public String toString() &#123;</span><br><span class="line">36         return movieName + &quot;\t&quot; + sex + &quot;\t&quot; + score ;</span><br><span class="line">37     &#125;</span><br><span class="line">38     @Override</span><br><span class="line">39     public void readFields(DataInput in) throws IOException &#123;</span><br><span class="line">40         movieName = in.readUTF();</span><br><span class="line">41         sex = in.readUTF();</span><br><span class="line">42         score = in.readDouble();</span><br><span class="line">43     &#125;</span><br><span class="line">44     @Override</span><br><span class="line">45     public void write(DataOutput out) throws IOException &#123;</span><br><span class="line">46         out.writeUTF(movieName);</span><br><span class="line">47         out.writeUTF(sex);</span><br><span class="line">48         out.writeDouble(score);</span><br><span class="line">49     &#125;</span><br><span class="line">50     @Override</span><br><span class="line">51     public int compareTo(MoviesSexBean o) &#123;</span><br><span class="line">52         </span><br><span class="line">53         int result = this.getSex().compareTo(o.getSex());</span><br><span class="line">54         if(result == 0) &#123;</span><br><span class="line">55             double diff = this.getScore() - o.getScore();</span><br><span class="line">56             </span><br><span class="line">57             if(diff == 0) &#123;</span><br><span class="line">58                 return 0;</span><br><span class="line">59             &#125;else &#123;</span><br><span class="line">60                 return diff &gt; 0 ? -1 : 1;</span><br><span class="line">61             &#125;</span><br><span class="line">62             </span><br><span class="line">63         &#125;else &#123;</span><br><span class="line">64             return result &gt; 0 ? -1 : 1;</span><br><span class="line">65         &#125;</span><br><span class="line">66         </span><br><span class="line">67     &#125;</span><br><span class="line">68     </span><br><span class="line">69     </span><br><span class="line">70     </span><br><span class="line">71 &#125;</span><br></pre></td></tr></table></figure>

<p>分组：MoviesSexGC.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> 1 public class MoviesSexGC extends WritableComparator&#123;</span><br><span class="line"> 2     </span><br><span class="line"> 3     public MoviesSexGC() &#123;</span><br><span class="line"> 4         super(MoviesSexBean.class,true);</span><br><span class="line"> 5     &#125;</span><br><span class="line"> 6     </span><br><span class="line"> 7     @Override</span><br><span class="line"> 8     public int compare(WritableComparable a, WritableComparable b) &#123;</span><br><span class="line"> 9         </span><br><span class="line">10         MoviesSexBean msb1 = (MoviesSexBean)a;</span><br><span class="line">11         MoviesSexBean msb2 = (MoviesSexBean)b;</span><br><span class="line">12 </span><br><span class="line">13         return msb1.getSex().compareTo(msb2.getSex());</span><br><span class="line">14     &#125;</span><br><span class="line">15     </span><br><span class="line">16 &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、求movieid-2116这部电影各年龄段（因为年龄就只有7个，就按这个7个分就好了）的平均影评（年龄段，评分）"><a href="#3、求movieid-2116这部电影各年龄段（因为年龄就只有7个，就按这个7个分就好了）的平均影评（年龄段，评分）" class="headerlink" title="3、求movieid = 2116这部电影各年龄段（因为年龄就只有7个，就按这个7个分就好了）的平均影评（年龄段，评分）"></a>3、求movieid = 2116这部电影各年龄段（因为年龄就只有7个，就按这个7个分就好了）的平均影评（年龄段，评分）</h3><p>以第二部三表联合之后的文件进行操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"> 1 public class MovieDemo3 &#123;</span><br><span class="line"> 2 </span><br><span class="line"> 3     public static void main(String[] args) throws Exception &#123;</span><br><span class="line"> 4         </span><br><span class="line"> 5         Configuration conf = new Configuration();</span><br><span class="line"> 6         FileSystem fs = FileSystem.get(conf);</span><br><span class="line"> 7         Job job = Job.getInstance(conf);</span><br><span class="line"> 8         </span><br><span class="line"> 9         job.setJarByClass(MovieDemo3.class);</span><br><span class="line">10         job.setMapperClass(MovieDemo3Mapper.class);</span><br><span class="line">11         job.setReducerClass(MovieDemo3Reducer.class);</span><br><span class="line">12         </span><br><span class="line">13         job.setOutputKeyClass(Text.class);</span><br><span class="line">14         job.setOutputValueClass(DoubleWritable.class);</span><br><span class="line">15         </span><br><span class="line">16         Path inputPath = new Path(&quot;D:\\MR\\hw\\movie\\3he1&quot;);</span><br><span class="line">17         Path outputPath = new Path(&quot;D:\\MR\\hw\\movie\\outpu3&quot;);</span><br><span class="line">18         </span><br><span class="line">19         if(fs.exists(outputPath)) &#123;</span><br><span class="line">20             fs.delete(outputPath,true);</span><br><span class="line">21         &#125;</span><br><span class="line">22         </span><br><span class="line">23         FileInputFormat.setInputPaths(job, inputPath);</span><br><span class="line">24         FileOutputFormat.setOutputPath(job, outputPath);</span><br><span class="line">25         </span><br><span class="line">26         boolean isDone = job.waitForCompletion(true);</span><br><span class="line">27         System.exit(isDone ? 0 : 1);</span><br><span class="line">28         </span><br><span class="line">29     &#125;</span><br><span class="line">30     </span><br><span class="line">31     </span><br><span class="line">32     /**</span><br><span class="line">33      * 1000::1036::4::975040964::Die Hard (1988)::Action|Thriller::F::25::6::90027</span><br><span class="line">34      * </span><br><span class="line">35      * 用户ID::电影ID::评分::评分时间戳::电影名字::电影类型::性别::年龄::职业::邮政编码</span><br><span class="line">36      * 0        1     2      3        4       5     6   7    8    9</span><br><span class="line">37      * </span><br><span class="line">38      * key:电影ID+电影名字+年龄段</span><br><span class="line">39      * value:评分</span><br><span class="line">40      * 求movieid = 2116这部电影各年龄段</span><br><span class="line">41      * */</span><br><span class="line">42     public static class MovieDemo3Mapper extends Mapper&lt;LongWritable, Text, Text, DoubleWritable&gt;&#123;</span><br><span class="line">43         </span><br><span class="line">44         Text outKey = new Text();</span><br><span class="line">45         DoubleWritable outValue = new DoubleWritable();</span><br><span class="line">46         </span><br><span class="line">47         @Override</span><br><span class="line">48         protected void map(LongWritable key, Text value, Context context)</span><br><span class="line">49                 throws IOException, InterruptedException &#123;</span><br><span class="line">50 </span><br><span class="line">51             String[] split = value.toString().split(&quot;::&quot;);</span><br><span class="line">52             int movieID = Integer.parseInt(split[1]);</span><br><span class="line">53             </span><br><span class="line">54             if(movieID == 2116) &#123;</span><br><span class="line">55                 String strKey = split[1]+&quot;\t&quot;+split[4]+&quot;\t&quot;+split[7];</span><br><span class="line">56                 String strValue = split[2];</span><br><span class="line">57                 </span><br><span class="line">58                 outKey.set(strKey);</span><br><span class="line">59                 outValue.set(Double.parseDouble(strValue));</span><br><span class="line">60                 </span><br><span class="line">61                 context.write(outKey, outValue);</span><br><span class="line">62             &#125;</span><br><span class="line">63             </span><br><span class="line">64         &#125;</span><br><span class="line">65     &#125;</span><br><span class="line">66     </span><br><span class="line">67     </span><br><span class="line">68     </span><br><span class="line">69     /**</span><br><span class="line">70      * 对map的输出结果求平均评分</span><br><span class="line">71      * */</span><br><span class="line">72     public static class MovieDemo3Reducer extends Reducer&lt;Text, DoubleWritable, Text, DoubleWritable&gt;&#123;</span><br><span class="line">73 </span><br><span class="line">74         DoubleWritable outValue = new DoubleWritable();</span><br><span class="line">75         </span><br><span class="line">76         @Override</span><br><span class="line">77         protected void reduce(Text key, Iterable&lt;DoubleWritable&gt; values, Context context)</span><br><span class="line">78                 throws IOException, InterruptedException &#123;</span><br><span class="line">79 </span><br><span class="line">80             int count = 0;</span><br><span class="line">81             double sum = 0;</span><br><span class="line">82             </span><br><span class="line">83             for(DoubleWritable value : values) &#123;</span><br><span class="line">84                 count++;</span><br><span class="line">85                 sum += Double.parseDouble(value.toString()); </span><br><span class="line">86             &#125;</span><br><span class="line">87             </span><br><span class="line">88             double avg = sum / count;</span><br><span class="line">89             </span><br><span class="line">90             outValue.set(avg);</span><br><span class="line">91             </span><br><span class="line">92             context.write(key, outValue);</span><br><span class="line">93             </span><br><span class="line">94         &#125;</span><br><span class="line">95         </span><br><span class="line">96     &#125;</span><br><span class="line">97     </span><br><span class="line">98 &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、求最喜欢看电影（影评次数最多）的那位女性评最高分的10部电影的平均影评分（人，电影名，影评）"><a href="#4、求最喜欢看电影（影评次数最多）的那位女性评最高分的10部电影的平均影评分（人，电影名，影评）" class="headerlink" title="4、求最喜欢看电影（影评次数最多）的那位女性评最高分的10部电影的平均影评分（人，电影名，影评）"></a>4、求最喜欢看电影（影评次数最多）的那位女性评最高分的10部电影的平均影评分（人，电影名，影评）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1000    ::    1036    ::    4    ::    975040964    ::    Die Hard (1988)    ::    Action|Thriller    ::    F    ::    25    ::    6    ::    90027</span><br><span class="line"></span><br><span class="line">用户ID        电影ID        评分     　　 评分时间戳             电影名字                  电影类型                性别        年龄        职业        邮政编码</span><br><span class="line"></span><br><span class="line">0　　　　　　　　1　　　　　　　　2　　　　　　　　3　　　　　　　　　　　　4　　　　　　　　　　　　　　5　　　　　　　　　　　　6　　　　　　7　　　　　　8　　　　　　   9</span><br></pre></td></tr></table></figure>

<p>（1）求出评论次数最多的女性ID</p>
<p>　　MoviesDemo4_1.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">  1 public class MoviesDemo4 &#123;</span><br><span class="line">  2 </span><br><span class="line">  3     public static void main(String[] args) throws Exception &#123;</span><br><span class="line">  4         </span><br><span class="line">  5         Configuration conf1 = new Configuration();</span><br><span class="line">  6         FileSystem fs1 = FileSystem.get(conf1);</span><br><span class="line">  7         Job job1 = Job.getInstance(conf1);</span><br><span class="line">  8         </span><br><span class="line">  9         job1.setJarByClass(MoviesDemo4.class);</span><br><span class="line"> 10         job1.setMapperClass(MoviesDemo4Mapper1.class);</span><br><span class="line"> 11         job1.setReducerClass(MoviesDemo4Reducer1.class);</span><br><span class="line"> 12         </span><br><span class="line"> 13         </span><br><span class="line"> 14         job1.setMapOutputKeyClass(Text.class);</span><br><span class="line"> 15         job1.setMapOutputValueClass(Text.class);</span><br><span class="line"> 16         job1.setOutputKeyClass(Text.class);</span><br><span class="line"> 17         job1.setOutputValueClass(DoubleWritable.class);</span><br><span class="line"> 18         </span><br><span class="line"> 19         </span><br><span class="line"> 20         Configuration conf2 = new Configuration();</span><br><span class="line"> 21         FileSystem fs2 = FileSystem.get(conf2);</span><br><span class="line"> 22         Job job2 = Job.getInstance(conf2);</span><br><span class="line"> 23         </span><br><span class="line"> 24         job2.setJarByClass(MoviesDemo4.class);</span><br><span class="line"> 25         job2.setMapperClass(MoviesDemo4Mapper2.class);</span><br><span class="line"> 26         job2.setReducerClass(MoviesDemo4Reducer2.class);</span><br><span class="line"> 27         </span><br><span class="line"> 28         job2.setMapOutputKeyClass(Moviegoers.class);</span><br><span class="line"> 29         job2.setMapOutputValueClass(NullWritable.class);</span><br><span class="line"> 30         job2.setOutputKeyClass(Moviegoers.class);</span><br><span class="line"> 31         job2.setOutputValueClass(NullWritable.class);</span><br><span class="line"> 32         </span><br><span class="line"> 33         Path inputPath1 = new Path(&quot;D:\\MR\\hw\\movie\\3he1&quot;);</span><br><span class="line"> 34         Path outputPath1 = new Path(&quot;D:\\MR\\hw\\movie\\outpu4_1&quot;);</span><br><span class="line"> 35         </span><br><span class="line"> 36         if(fs1.exists(outputPath1)) &#123;</span><br><span class="line"> 37             fs1.delete(outputPath1,true);</span><br><span class="line"> 38         &#125;</span><br><span class="line"> 39         </span><br><span class="line"> 40         FileInputFormat.setInputPaths(job1, inputPath1);</span><br><span class="line"> 41         FileOutputFormat.setOutputPath(job1, outputPath1);</span><br><span class="line"> 42         </span><br><span class="line"> 43         </span><br><span class="line"> 44         Path inputPath2 = new Path(&quot;D:\\MR\\hw\\movie\\outpu4_1&quot;);</span><br><span class="line"> 45         Path outputPath2 = new Path(&quot;D:\\MR\\hw\\movie\\outpu4_2&quot;);</span><br><span class="line"> 46         </span><br><span class="line"> 47         if(fs2.exists(outputPath2)) &#123;</span><br><span class="line"> 48             fs2.delete(outputPath2,true);</span><br><span class="line"> 49         &#125;</span><br><span class="line"> 50         </span><br><span class="line"> 51         FileInputFormat.setInputPaths(job2, inputPath2);</span><br><span class="line"> 52         FileOutputFormat.setOutputPath(job2, outputPath2);</span><br><span class="line"> 53         </span><br><span class="line"> 54         JobControl control = new JobControl(&quot;MoviesDemo4&quot;);</span><br><span class="line"> 55         </span><br><span class="line"> 56         ControlledJob ajob = new ControlledJob(job1.getConfiguration());</span><br><span class="line"> 57         ControlledJob bjob = new ControlledJob(job2.getConfiguration());</span><br><span class="line"> 58         </span><br><span class="line"> 59         bjob.addDependingJob(ajob);</span><br><span class="line"> 60         </span><br><span class="line"> 61         control.addJob(ajob);</span><br><span class="line"> 62         control.addJob(bjob);</span><br><span class="line"> 63         </span><br><span class="line"> 64         Thread thread = new Thread(control);</span><br><span class="line"> 65         thread.start();</span><br><span class="line"> 66         </span><br><span class="line"> 67         while(!control.allFinished()) &#123;</span><br><span class="line"> 68             thread.sleep(1000);</span><br><span class="line"> 69         &#125;</span><br><span class="line"> 70         System.exit(0);</span><br><span class="line"> 71     &#125;</span><br><span class="line"> 72     </span><br><span class="line"> 73     /**</span><br><span class="line"> 74      * 1000::1036::4::975040964::Die Hard (1988)::Action|Thriller::F::25::6::90027</span><br><span class="line"> 75      * </span><br><span class="line"> 76      * 用户ID::电影ID::评分::评分时间戳::电影名字::电影类型::性别::年龄::职业::邮政编码</span><br><span class="line"> 77      * 0        1     2      3        4       5     6   7    8    9</span><br><span class="line"> 78      * </span><br><span class="line"> 79      * 1、key:用户ID</span><br><span class="line"> 80       * 2、value：电影名+评分</span><br><span class="line"> 81      * </span><br><span class="line"> 82      * */</span><br><span class="line"> 83     public static class MoviesDemo4Mapper1 extends Mapper&lt;LongWritable, Text, Text, Text&gt;&#123;</span><br><span class="line"> 84         </span><br><span class="line"> 85         Text outKey = new Text();</span><br><span class="line"> 86         Text outValue = new Text();</span><br><span class="line"> 87         </span><br><span class="line"> 88         @Override</span><br><span class="line"> 89         protected void map(LongWritable key, Text value, Context context)</span><br><span class="line"> 90                 throws IOException, InterruptedException &#123;</span><br><span class="line"> 91             </span><br><span class="line"> 92             String[] split = value.toString().split(&quot;::&quot;);</span><br><span class="line"> 93             </span><br><span class="line"> 94             String strKey = split[0];</span><br><span class="line"> 95             String strValue = split[4]+&quot;\t&quot;+split[2];</span><br><span class="line"> 96             </span><br><span class="line"> 97             if(split[6].equals(&quot;F&quot;)) &#123;</span><br><span class="line"> 98                 outKey.set(strKey);</span><br><span class="line"> 99                 outValue.set(strValue);</span><br><span class="line">100                 context.write(outKey, outValue);</span><br><span class="line">101             &#125;</span><br><span class="line">102             </span><br><span class="line">103         &#125;</span><br><span class="line">104         </span><br><span class="line">105     &#125;</span><br><span class="line">106     </span><br><span class="line">107     //统计每位女性的评论总数</span><br><span class="line">108     public static class MoviesDemo4Reducer1 extends Reducer&lt;Text, Text, Text, IntWritable&gt;&#123;</span><br><span class="line">109         </span><br><span class="line">110         IntWritable outValue = new IntWritable();</span><br><span class="line">111         </span><br><span class="line">112         @Override</span><br><span class="line">113         protected void reduce(Text key, Iterable&lt;Text&gt; values, Context context)</span><br><span class="line">114                 throws IOException, InterruptedException &#123;</span><br><span class="line">115 </span><br><span class="line">116             int count = 0;</span><br><span class="line">117             for(Text value : values) &#123;</span><br><span class="line">118                 count++;</span><br><span class="line">119             &#125;</span><br><span class="line">120             outValue.set(count);</span><br><span class="line">121             context.write(key, outValue);</span><br><span class="line">122         &#125;</span><br><span class="line">123         </span><br><span class="line">124     &#125;</span><br><span class="line">125     </span><br><span class="line">126     //对第一次MapReduce的输出结果进行降序排序</span><br><span class="line">127     public static class MoviesDemo4Mapper2 extends Mapper&lt;LongWritable, Text,Moviegoers,NullWritable&gt;&#123;</span><br><span class="line">128         </span><br><span class="line">129         Moviegoers outKey = new Moviegoers();</span><br><span class="line">130         </span><br><span class="line">131         @Override</span><br><span class="line">132         protected void map(LongWritable key, Text value, Context context)</span><br><span class="line">133                 throws IOException, InterruptedException &#123;</span><br><span class="line">134             </span><br><span class="line">135             String[] split = value.toString().split(&quot;\t&quot;);</span><br><span class="line">136             </span><br><span class="line">137             outKey.setName(split[0]);</span><br><span class="line">138             outKey.setCount(Integer.parseInt(split[1]));</span><br><span class="line">139             context.write(outKey, NullWritable.get());</span><br><span class="line">140         &#125;</span><br><span class="line">141         </span><br><span class="line">142     &#125;</span><br><span class="line">143     </span><br><span class="line">144     //排序之后取第一个值（评论最多的女性ID和评论次数）</span><br><span class="line">145     public static class MoviesDemo4Reducer2 extends Reducer&lt;Moviegoers,NullWritable, Moviegoers,NullWritable&gt;&#123;</span><br><span class="line">146         </span><br><span class="line">147         int count = 0;</span><br><span class="line">148         </span><br><span class="line">149         @Override</span><br><span class="line">150         protected void reduce(Moviegoers key, Iterable&lt;NullWritable&gt; values,Context context)</span><br><span class="line">151                 throws IOException, InterruptedException &#123;</span><br><span class="line">152 </span><br><span class="line">153             for(NullWritable nvl : values) &#123;</span><br><span class="line">154                 count++;</span><br><span class="line">155                 if(count &gt; 1) &#123;</span><br><span class="line">156                     return;</span><br><span class="line">157                 &#125;</span><br><span class="line">158                 context.write(key, nvl);    </span><br><span class="line">159             &#125;</span><br><span class="line">160         </span><br><span class="line">161         &#125;</span><br><span class="line">162         </span><br><span class="line">163     &#125;</span><br><span class="line">164     </span><br><span class="line">165     </span><br><span class="line">166 &#125;</span><br></pre></td></tr></table></figure>
    </div>
    
    <div class="post-footer">
        <div>
            
            转载声明：
            商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="https://github.com/wenxinzhang" target="_blank">福星</a>
            
            
        </div>
        <div>
            
        </div>
    </div>
</article>
<div class="article-nav prev-next-wrap clearfix">
    
    <a href="/2018-04-27-Hadoop学习之路（二十七）MapReduce的API使用（四）.html" class="pre-post btn btn-default" title='Hadoop学习之路（二十七）MapReduce的API使用（四）'>
        <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
        <span class="hidden-xs">
            Hadoop学习之路（二十七）MapReduce的API使用（四）</span>
    </a>
    
    
    <a href="/2018-04-24-Hadoop学习之路（二十四）YARN的资源调度.html" class="next-post btn btn-default" title='Hadoop学习之路（二十四）YARN的资源调度'>
        <span class="hidden-lg">下一篇</span>
        <span class="hidden-xs">
            Hadoop学习之路（二十四）YARN的资源调度</span><i class="fa fa-angle-right fa-fw"></i>
    </a>
    
</div>

<div id="comments">
    

<div id="vcomments" class="valine"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="/assets/valine.min.js"></script>
<script>
new Valine({
    av: AV,
    el: '#vcomments',
    appId: 'UckE9LEIQ8aoa3MH1Kio27rB-gzGzoHsz',
    appKey: '7HC9xCVYQdshKqFRDmULFm5G',
    placeholder: '说点什么吧',
    notify: false,
    verify: true,
    avatar: 'mm',
    meta: 'nick,mail'.split(','),
    pageSize: '10',
    path: window.location.pathname,
    lang: 'zh-CN'.toLowerCase()
})
</script>


</div>

                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">
            文章目录
        </h3>
        
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据及需求"><span class="toc-text">数据及需求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据格式"><span class="toc-text">数据格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据解释"><span class="toc-text">数据解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#需求统计"><span class="toc-text">需求统计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码实现"><span class="toc-text">代码实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、求被评分次数最多的10部电影，并给出评分次数（电影名，评分次数）"><span class="toc-text">1、求被评分次数最多的10部电影，并给出评分次数（电影名，评分次数）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）"><span class="toc-text">2、分别求男性，女性当中评分最高的10部电影（性别，电影名，评分）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、求movieid-2116这部电影各年龄段（因为年龄就只有7个，就按这个7个分就好了）的平均影评（年龄段，评分）"><span class="toc-text">3、求movieid = 2116这部电影各年龄段（因为年龄就只有7个，就按这个7个分就好了）的平均影评（年龄段，评分）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4、求最喜欢看电影（影评次数最多）的那位女性评最高分的10部电影的平均影评分（人，电影名，影评）"><span class="toc-text">4、求最喜欢看电影（影评次数最多）的那位女性评最高分的10部电影的平均影评分（人，电影名，影评）</span></a></li></ol></li></ol>
        
    </div>
</aside>
                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>
<a id="back-to-top" class="icon-btn hide">
    <i class="fa fa-chevron-up"></i>
</a>
    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="busuanzi">
    
    访问量:
    <strong id="busuanzi_value_site_pv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    &nbsp; | &nbsp;
    访客数:
    <strong id="busuanzi_value_site_uv">
        <i class="fa fa-spinner fa-spin"></i>
    </strong>
    
</div>
            </div>
            <div class="col-sm-12">
                <span>Copyright &copy;
                    2018
                </span> |
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> |
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/js/app.js?rev=@@hash"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":200,"height":350},"mobile":{"show":true}});</script></body>
</html>